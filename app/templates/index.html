<!DOCTYPE html>
<html lang="en">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueSign - Análisis de Transferencias con IA</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- html2pdf.js for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Sistema de traducciones -->
    <script src="{{ url_for('static', filename='translations.js') }}"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background */
        }
        .sidebar {
            width: 250px;
            background-color: #1a202c; /* Darker sidebar */
        }
        .main-content {
            margin-left: 250px;
        }
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #374151; /* gray-700 */
        }
        .breakdown-item:last-child {
            border-bottom: none;
        }
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 0;
        }
        .nav-item:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            transform: translateX(4px);
        }
        .nav-item.active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            border-left: 3px solid #10b981;
        }
        .page-content {
            display: none;
            position: fixed;
            top: 0;
            left: 250px;
            width: calc(100vw - 250px);
            height: 100vh;
            background-color: #0d1117;
            z-index: 5;
            overflow-y: auto;
        }
        .page-content.active {
            display: block;
        }
        .page-content > div {
            width: 100%;
            max-width: none;
            padding: 1rem;
        }
        .skeleton-loading {
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.5) 25%, rgba(75, 85, 99, 0.5) 50%, rgba(30, 41, 59, 0.5) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
  </style>
 </head>
<body class="flex min-h-screen text-gray-100">
    <!-- Landing Page -->
    <div id="landing" class="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900">
        <!-- Header -->
        <header class="bg-gray-800 bg-opacity-50 backdrop-blur-sm">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div class="flex items-center">
                        <img id="landingLogo" src="/static/logo.png" alt="TrueSign Logo" class="h-32 w-auto">
                </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showLanguageSelector()" class="text-gray-300 hover:text-white transition duration-200">
                            <i class="fas fa-globe mr-2"></i>ES/EN
                        </button>
                        <button onclick="showLoginForm()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition duration-200">
                            <i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión
                        </button>
            </div>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="relative py-20 px-4 sm:px-6 lg:px-8 flex items-center justify-center min-h-screen">
            <div class="max-w-full mx-auto text-center px-8">
                <h1 class="text-6xl md:text-8xl font-extrabold text-white mb-8">
                    El Futuro de las
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-400">
                        Transferencias
                    </span>
                </h1>
                <p class="text-2xl md:text-3xl text-gray-300 mb-12 max-w-5xl mx-auto">
                    TrueSign utiliza inteligencia artificial avanzada para analizar más de 92,000 transferencias reales 
                    y predecir el valor óptimo de cualquier jugador con 95% de precisión.
                </p>
                <div class="flex flex-col sm:flex-row gap-6 justify-center">
                    <button onclick="showLoginForm()" class="bg-green-600 hover:bg-green-700 text-white px-12 py-6 rounded-lg text-xl font-semibold transition duration-200 shadow-lg">
                        <i class="fas fa-rocket mr-3"></i>Comenzar Análisis
                    </button>
                    <button onclick="scrollToFeatures()" class="bg-transparent border-2 border-white text-white hover:bg-white hover:text-gray-900 px-12 py-6 rounded-lg text-xl font-semibold transition duration-200">
                        <i class="fas fa-info-circle mr-3"></i>Conocer Más
    </button>
    </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="py-20 px-4 sm:px-6 lg:px-8 bg-gray-800 bg-opacity-30">
            <div class="max-w-full mx-auto text-center px-8">
                <h2 class="text-5xl font-bold text-white mb-20">¿Por qué TrueSign?</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Feature 1 -->
                    <div class="bg-gray-800 bg-opacity-50 p-8 rounded-xl border border-gray-700 hover:border-green-500 transition duration-300">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-database text-white text-2xl"></i>
          </div>
                            <h3 class="text-2xl font-bold text-white mb-4">Datos Reales</h3>
                            <p class="text-gray-300">
                                Analizamos más de 92,000 transferencias reales de jugadores profesionales 
                                de todas las ligas del mundo.
                            </p>
          </div>
        </div>
                
                    <!-- Feature 2 -->
                    <div class="bg-gray-800 bg-opacity-50 p-8 rounded-xl border border-gray-700 hover:border-blue-500 transition duration-300">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-brain text-white text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-4">IA Avanzada</h3>
                            <p class="text-gray-300">
                                Utilizamos algoritmos de machine learning de última generación 
                                para predecir valores con máxima precisión.
                            </p>
                        </div>
                    </div>

                    <!-- Feature 3 -->
                    <div class="bg-gray-800 bg-opacity-50 p-8 rounded-xl border border-gray-700 hover:border-purple-500 transition duration-300">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-chart-line text-white text-2xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-4">95% Precisión</h3>
                            <p class="text-gray-300">
                                Nuestro modelo tiene una precisión del 95% en la predicción 
                                de valores de transferencia y ROI.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="py-20 px-4 sm:px-6 lg:px-8">
            <div class="max-w-full mx-auto text-center px-8">
                <h2 class="text-5xl font-bold text-white mb-20">Cómo Funciona</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                    <!-- Step 1 -->
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-white font-bold text-2xl">1</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-4">Ingresa Datos</h3>
                        <p class="text-gray-300">
                            Selecciona el jugador y el club de destino. 
                            Nuestro sistema analiza automáticamente todas las variables.
                        </p>
                    </div>

                    <!-- Step 2 -->
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-white font-bold text-2xl">2</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-4">Análisis IA</h3>
                        <p class="text-gray-300">
                            Nuestra IA procesa más de 50 variables incluyendo rendimiento, 
                            edad, posición, contexto del club y transferencias similares.
                        </p>
                    </div>

                    <!-- Step 3 -->
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-white font-bold text-2xl">3</span>
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-4">Resultados</h3>
                        <p class="text-gray-300">
                            Recibe el precio óptimo, ROI estimado, análisis detallado 
                            y los 5 valores fundamentales del jugador.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full border border-gray-700 relative">
                <div class="text-center mb-8">
                    <img id="loginLogo" src="/static/logo.png" alt="TrueSign Logo" class="h-32 mx-auto mb-4">
                    <h2 class="text-3xl font-bold text-white">Iniciar Sesión</h2>
                    <p class="text-gray-400 mt-2">Accede a tu cuenta TrueSign</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-gray-300 text-sm font-semibold mb-2">Usuario</label>
                        <input type="text" id="username" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="Ingresa tu usuario" required>
                    </div>
                    
                    <div>
                        <label class="block text-gray-300 text-sm font-semibold mb-2">Contraseña</label>
                        <input type="password" id="password" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-green-500" placeholder="Ingresa tu contraseña" required>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2">
                            <span class="text-gray-300 text-sm">Recordarme</span>
                        </label>
                        <a href="#" class="text-green-400 hover:text-green-300 text-sm">¿Olvidaste tu contraseña?</a>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                        <i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión
                </button>
                </form>
                
                <div class="text-center mt-6">
                    <p class="text-gray-400">¿No tienes cuenta? 
                        <a href="#" class="text-green-400 hover:text-green-300">Regístrate aquí</a>
                    </p>
      </div>
                
                <button onclick="hideLoginForm()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
        </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-lg p-8 w-full max-w-md relative">
                <h2 class="text-2xl font-bold text-white mb-6">Cambiar Contraseña</h2>
                
                <form id="changePasswordForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Contraseña Actual</label>
                        <input type="password" id="currentPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-green-400 focus:outline-none" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Nueva Contraseña</label>
                        <input type="password" id="newPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-green-400 focus:outline-none" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Confirmar Nueva Contraseña</label>
                        <input type="password" id="confirmPassword" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-green-400 focus:outline-none" required>
                    </div>
                    
                    <div class="flex space-x-4 pt-4">
                        <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-3 rounded-lg font-medium transition-colors">
                            Cambiar Contraseña
                        </button>
                        <button type="button" onclick="hideChangePasswordModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-3 rounded-lg font-medium transition-colors">
                            Cancelar
                        </button>
                    </div>
                </form>
                
                <button onclick="hideChangePasswordModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 bg-opacity-50 py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-full mx-auto text-center px-8">
                <div class="flex items-center justify-center mb-6">
                    <img id="footerLogo" src="/static/logo.png" alt="TrueSign Logo" class="h-32 w-auto">
      </div>
                <p class="text-gray-400 mb-6 text-xl">La plataforma de análisis de transferencias más avanzada del mundo</p>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition duration-200">
                        <i class="fab fa-twitter text-2xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-200">
                        <i class="fab fa-linkedin text-2xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white transition duration-200">
                        <i class="fab fa-github text-2xl"></i>
                    </a>
                </div>
                <p class="text-gray-500 text-sm mt-6">© 2024 TrueSign. Todos los derechos reservados.</p>
            </div>
        </footer>
            </div>
            
    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="flex h-screen bg-gray-900">
            <!-- Sidebar -->
            <aside class="sidebar fixed top-0 left-0 h-full p-6 flex flex-col rounded-r-lg shadow-xl">
                <div class="flex items-center justify-center mb-10">
                    <!-- TrueSign Logo -->
                    <img id="dashboardLogo" src="/static/logo.png" alt="TrueSign Logo" class="h-20 object-contain">
                </div>
                <nav class="flex-grow">
                    <ul>
                        <li class="mb-4">
                            <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-300 hover:text-white cursor-pointer active" onclick="showPage('dashboard')">
                                <i class="fas fa-tachometer-alt mr-3"></i><span data-i18n="nav_dashboard">Dashboard</span>
                            </a>
                        </li>
                        <li class="mb-4">
                            <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-300 hover:text-white cursor-pointer" onclick="showPage('search')">
                                <i class="fas fa-search mr-3"></i><span data-i18n="nav_search">Buscar Jugadores</span>
                            </a>
                        </li>
                        <li class="mb-4">
                            <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-300 hover:text-white cursor-pointer" onclick="showPage('compare')">
                                <i class="fas fa-exchange-alt mr-3"></i><span data-i18n="nav_compare">Comparar Jugadores</span>
                            </a>
                        </li>
                        <li class="mb-4">
                            <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-300 hover:text-white cursor-pointer" onclick="showPage('reports')">
                                <i class="fas fa-chart-line mr-3"></i><span data-i18n="nav_reports">Reportes ROI</span>
                            </a>
                        </li>
                        <li class="mb-4">
                            <a href="#" class="nav-item flex items-center px-4 py-2 text-gray-300 hover:text-white cursor-pointer" onclick="showPage('settings')">
                                <i class="fas fa-cog mr-3"></i><span data-i18n="nav_settings">Configuración</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <div class="mt-auto">
                    <a href="#" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 rounded-md transition duration-200" onclick="logout()">
                        <i class="fas fa-sign-out-alt mr-3"></i><span data-i18n="nav_logout">Cerrar Sesión</span>
                    </a>
                </div>
            </aside>
  
        <!-- Main Content -->
            <div class="main-content flex-1 ml-64">
                <!-- Dashboard Page -->
        <div id="dashboard" class="page-content active">
            <div class="flex-grow p-8">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
                    <h1 class="text-4xl font-extrabold text-white">Dashboard TrueSign</h1>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-400">Usuario: <span class="text-green-400 font-semibold" id="userDisplayName">Panel de control</span></span>
                        <i class="fas fa-bell text-gray-400 hover:text-white cursor-pointer text-xl"></i>
                        <img id="userAvatar" src="https://placehold.co/40x40/374151/FFFFFF?text=U" alt="User Avatar" class="rounded-full border-2 border-green-500">
            </div>
                </header>

                <!-- Welcome Section -->
                <section class="bg-gradient-to-r from-green-600 to-blue-600 p-8 rounded-lg shadow-lg mb-8">
                    <h2 class="text-3xl font-bold text-white mb-4">¡Bienvenido a TrueSign!</h2>
                    <p class="text-green-100 text-lg">Tu sistema de análisis de transferencias más avanzado del mundo</p>
                </section>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <div class="flex items-center">
                            <i class="fas fa-users text-green-500 text-3xl mr-4"></i>
                            <div>
                                <h3 class="text-2xl font-bold text-white">92,671</h3>
                                <p class="text-gray-400">Jugadores Analizados</p>
        </div>
        </div>
        </div>
                    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <div class="flex items-center">
                            <i class="fas fa-exchange-alt text-blue-500 text-3xl mr-4"></i>
                            <div>
                                <h3 class="text-2xl font-bold text-white">900,000+</h3>
                                <p class="text-gray-400">Transferencias Analizadas</p>
        </div>
    </div>
            </div>
                    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <div class="flex items-center">
                            <i class="fas fa-chart-line text-purple-500 text-3xl mr-4"></i>
                            <div>
                                <h3 class="text-2xl font-bold text-white">95.2%</h3>
                                <p class="text-gray-400">Precisión del Modelo</p>
        </div>
        </div>
    </div>
            </div>

                <!-- Model Explanation Section -->
                <section class="bg-gray-800 p-8 rounded-lg shadow-md border border-gray-700 mb-8">
                    <h2 class="text-3xl font-bold text-white mb-6 text-center">¿Cómo Funciona TrueSign?</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Step 1 -->
                        <div class="bg-gray-700 p-6 rounded-lg border border-gray-600">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-white font-bold text-xl">1</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">Análisis de Datos</h3>
                            </div>
                            <p class="text-gray-300 text-sm leading-relaxed">
                                Analizamos más de <strong class="text-green-400">92,000 transferencias</strong> reales de jugadores profesionales, 
                                incluyendo datos de mercado, rendimiento deportivo y contexto del club.
                            </p>
            </div>
                    
                        <!-- Step 2 -->
                        <div class="bg-gray-700 p-6 rounded-lg border border-gray-600">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-white font-bold text-xl">2</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">Los 5 Valores Fundamentales</h3>
                            </div>
                            <p class="text-gray-300 text-sm leading-relaxed">
                                Calculamos el valor basado en <strong class="text-blue-400">5 componentes clave</strong>: 
                                Marketing, Deportivo, Reventa, Transferencias Similares y Valores de Mercado.
                            </p>
                        </div>

                        <!-- Step 3 -->
                        <div class="bg-gray-700 p-6 rounded-lg border border-gray-600">
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="text-white font-bold text-xl">3</span>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">IA Predictiva</h3>
                            </div>
                            <p class="text-gray-300 text-sm leading-relaxed">
                                Utilizamos <strong class="text-purple-400">inteligencia artificial avanzada</strong> para predecir 
                                el precio óptimo y el ROI esperado con una precisión del 95%.
                            </p>
                        </div>
                    </div>

                    <!-- Methodology Details -->
                    <div class="mt-8 bg-gray-700 p-6 rounded-lg border border-gray-600">
                        <h3 class="text-xl font-bold text-white mb-4 text-center">Metodología Científica</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-semibold text-green-400 mb-3">📊 Datos Analizados</h4>
                                <ul class="text-gray-300 text-sm space-y-2">
                                    <li>• <strong>92,671 transferencias</strong> de jugadores profesionales</li>
                                    <li>• <strong>2,174 clubes</strong> de diferentes ligas mundiales</li>
                                    <li>• <strong>1,399 multiplicadores</strong> de clubes específicos</li>
                                    <li>• Datos de rendimiento, edad, posición y contexto</li>
                                </ul>
            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-blue-400 mb-3">🎯 Precisión del Modelo</h4>
                                <ul class="text-gray-300 text-sm space-y-2">
                                    <li>• <strong>95% de precisión</strong> en predicciones</li>
                                    <li>• Análisis de <strong>transferencias similares</strong></li>
                                    <li>• Consideración del <strong>contexto del club</strong></li>
                                    <li>• Cálculo de <strong>ROI estimado</strong></li>
                                </ul>
            </div>
            </div>
        </div>

                    <!-- Key Features -->
                    <div class="mt-6 text-center">
                        <h4 class="text-lg font-semibold text-white mb-4">¿Por qué TrueSign es único?</h4>
                        <div class="flex flex-wrap justify-center gap-4">
                            <span class="bg-green-600 text-white px-4 py-2 rounded-full text-sm font-semibold">✅ Datos Reales</span>
                            <span class="bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold">✅ IA Avanzada</span>
                            <span class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-semibold">✅ Precisión 95%</span>
                            <span class="bg-yellow-600 text-white px-4 py-2 rounded-full text-sm font-semibold">✅ ROI Predictivo</span>
                </div>
                    </div>
                </section>

                <!-- Recent Players -->
                <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-4">Jugadores Recientes</h2>
                    <div class="text-gray-400 text-center py-8">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <p>Busca jugadores para verlos aquí</p>
        </div>
                </section>
                </div>
                </div>
                    
        <!-- Search Page -->
        <div id="search" class="page-content">
            <div class="flex-grow p-8">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
                    <h1 class="text-4xl font-extrabold text-white" data-i18n="nav_search">Search Players</h1>
                </header>

                <!-- Search Form -->
                <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-8">
                    <h2 class="text-2xl font-bold text-white mb-4" data-i18n="player_analysis">Player Analysis</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2" data-i18n="player_name">Player Name</label>
                            <div class="relative">
                                <input type="text" id="playerSearch2" placeholder="ej: Lionel Messi" data-placeholder-i18n="player_name_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                                <div id="autocompleteDropdown2" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
                </div>
            </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2" data-i18n="target_roi">Target ROI (%)</label>
                            <select id="roiTarget" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                                <option value="10">10% - Conservative</option>
                                <option value="20">20% - Moderate</option>
                                <option value="30" selected>30% - Balanced</option>
                                <option value="40">40% - Aggressive</option>
                                <option value="50">50% - High Risk</option>
                                <option value="60">60% - Very Aggressive</option>
                                <option value="70">70% - Extreme</option>
                                <option value="80">80% - Maximum</option>
                            </select>
        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2" data-i18n="destination_club">Destination Club</label>
                            <div class="relative">
                                <input type="text" id="clubDestino" placeholder="Buscar club destino..." data-placeholder-i18n="destination_club_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                                <div id="clubDestinoDropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
    </div>
                        </div>
                        <div class="flex items-end">
                            <button onclick="searchPlayerFromPage('search')" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-md transition duration-300 ease-in-out shadow-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                                <i class="fas fa-search mr-2"></i><span data-i18n="analyze_player">Analyze Player</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Results Section -->
                <div id="resultsSection2" class="hidden">
                    <!-- Player Info Card -->
                    <div id="playerInfoCard2" class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <!-- Player info will be populated here -->
        </div>
                    
                    <!-- Analysis Card -->
                    <div id="analysisCard2" class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <!-- Analysis will be populated here -->
        </div>
                    
                    <!-- 5 Values Section -->
                    <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="five_values_title">Los 5 Valores Fundamentales</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
                            <div class="bg-gray-700 p-4 rounded-lg text-center">
                                <h3 class="text-lg font-semibold text-green-400 mb-2" data-i18n="value_marketing">Valor de Marketing</h3>
                                <p id="marketingValue2" class="text-2xl font-bold text-white">€0.0M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded-lg text-center">
                                <h3 class="text-lg font-semibold text-blue-400 mb-2" data-i18n="value_sporting">Valor Deportivo</h3>
                                <p id="sportValue2" class="text-2xl font-bold text-white">€0.0M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded-lg text-center">
                                <h3 class="text-lg font-semibold text-purple-400 mb-2" data-i18n="value_resale">Valor de Reventa</h3>
                                <p id="resaleValue2" class="text-2xl font-bold text-white">€0.0M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded-lg text-center">
                                <h3 class="text-lg font-semibold text-yellow-400 mb-2" data-i18n="value_similar">Transferencias Similares</h3>
                                <p id="similarTransfersValue2" class="text-2xl font-bold text-white">€0.0M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded-lg text-center">
                                <h3 class="text-lg font-semibold text-red-400 mb-2" data-i18n="value_market">Valores de Mercado</h3>
                                <p id="marketValuesValue2" class="text-2xl font-bold text-white">€0.0M</p>
                            </div>
                        </div>
                    </section>

                    <!-- Predicción ML de Valor Post-Transferencia -->
                    <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="ml_prediction_title">Predicción ML Mejorada con Análisis de Club</h2>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-300 mb-2">
                                    <span data-i18n="predicted_change">Cambio Predicho</span>:
                                </h3>
                                <p id="predictedChange" class="text-xl font-bold text-green-400">--%</p>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-300 mb-2">
                                    <span data-i18n="future_value">Valor Futuro</span>:
                                </h3>
                                <p id="futureValue" class="text-xl font-bold text-blue-400">€--M</p>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-300 mb-2">
                                    <span data-i18n="confidence">Confianza</span>:
                                </h3>
                                <p id="predictionConfidence" class="text-xl font-bold text-purple-400">--%</p>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center gap-3">
                            <h3 class="text-lg font-semibold text-gray-300">
                                <span data-i18n="club_destino">Club Destino</span>:
                            </h3>
                            <p id="clubDestinoDisplay" class="text-xl font-bold text-cyan-400">--</p>
                        </div>
                        
                        <!-- Análisis LLM -->
                        <div class="mt-6 bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded-lg p-4">
                            <h3 class="text-lg font-semibold text-purple-300 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                                <span data-i18n="intelligent_analysis">Análisis Inteligente</span>
                            </h3>
                            <p id="llmAnalysisText" class="text-gray-300 leading-relaxed text-sm" data-i18n="generating_analysis">Generando análisis...
                            </p>
                        </div>
                    </section>
      </div>
      </div>
     </div>
                    
        <!-- Compare Page -->
        <div id="compare" class="page-content">
            <div class="flex-grow p-8">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
                    <h1 class="text-4xl font-extrabold text-white" data-i18n="compare_players">Compare Players</h1>
                </header>

                <!-- Player Search Forms -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Player 1 -->
                    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <h2 class="text-xl font-bold text-white mb-4" data-i18n="player_1">Player 1</h2>
                        <div class="relative mb-4">
                            <input type="text" id="player1Search" placeholder="Buscar jugador..." data-placeholder-i18n="search_player_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                            <div id="player1Dropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
        </div>
                        <div class="relative mb-4">
                            <input type="text" id="club1Search" placeholder="Club destino..." data-placeholder-i18n="search_club_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                            <div id="club1Dropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
        </div>
                        <button onclick="searchPlayer1()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                            <span data-i18n="search_player_1">Search Player 1</span>
                        </button>
                        
                        <!-- Player 1 Results -->
                        <div id="player1Results" class="mt-6 hidden">
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center overflow-hidden">
                                        <img id="player1Photo" class="w-full h-full object-cover rounded-full hidden" alt="Player Photo">
                                        <span id="player1Initials" class="text-white font-bold text-lg">--</span>
     </div>
                                    <div>
                                        <h3 id="player1Name" class="text-xl font-bold text-white">--</h3>
                                        <p id="player1Club" class="text-gray-400">--</p>
                                        <p id="player1Info" class="text-gray-400 text-sm">--</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-gray-400 text-sm" data-i18n="market_value">Market Value:</p>
                                        <p id="player1MarketValue" class="text-green-400 font-semibold">€--M</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400 text-sm" data-i18n="recommended_price">Recommended Price:</p>
                                        <p id="player1RecommendedPrice" class="text-blue-400 font-semibold">€--M</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400 text-sm">Estimated ROI:</p>
                                        <p id="player1ROI" class="text-purple-400 font-semibold">--%</p>
                                    </div>
      </div>
      </div>

                            <!-- Player 1 Five Values -->
                            <div class="mt-4">
                                <h4 class="text-lg font-semibold text-white mb-3">The 5 Fundamental Values</h4>
                                <div class="grid grid-cols-5 gap-2">
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Marketing</p>
                                        <p id="player1Marketing" class="text-green-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Sporting</p>
                                        <p id="player1Sport" class="text-blue-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Resale</p>
                                        <p id="player1Resale" class="text-purple-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Similar</p>
                                        <p id="player1Similar" class="text-yellow-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Market</p>
                                        <p id="player1Market" class="text-red-400 font-bold text-sm">€--M</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Player 1 Club Destino -->
                            <div class="mt-4 flex items-center gap-3">
                                <h4 class="text-sm font-semibold text-gray-300" data-i18n="destination_club">Destination Club:</h4>
                                <p id="player1ClubDestino" class="text-base font-bold text-cyan-400">--</p>
                            </div>
                            
                            <!-- Player 1 Análisis LLM -->
                            <div class="mt-4">
                                <h4 class="text-lg font-semibold text-white mb-3">Intelligent Analysis</h4>
                                <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded p-3">
                                    <p id="player1LLMAnalysis" class="text-gray-300 text-sm leading-relaxed">Generating analysis...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Player 2 -->
                    <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <h2 class="text-xl font-bold text-white mb-4" data-i18n="player_2">Player 2</h2>
                        <div class="relative mb-4">
                            <input type="text" id="player2Search" placeholder="Buscar jugador..." data-placeholder-i18n="search_player_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                            <div id="player2Dropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
                        </div>
                        <div class="relative mb-4">
                            <input type="text" id="club2Search" placeholder="Club destino..." data-placeholder-i18n="search_club_placeholder" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                            <div id="club2Dropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
                        </div>
                        <button onclick="searchPlayer2()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                            <span data-i18n="search_player_2">Search Player 2</span>
                    </button>
                        
                        <!-- Player 2 Results -->
                        <div id="player2Results" class="mt-6 hidden">
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center overflow-hidden">
                                        <img id="player2Photo" class="w-full h-full object-cover rounded-full hidden" alt="Player Photo">
                                        <span id="player2Initials" class="text-white font-bold text-lg">--</span>
                                    </div>
                                    <div>
                                        <h3 id="player2Name" class="text-xl font-bold text-white">--</h3>
                                        <p id="player2Club" class="text-gray-400">--</p>
                                        <p id="player2Info" class="text-gray-400 text-sm">--</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-gray-400 text-sm" data-i18n="market_value">Market Value:</p>
                                        <p id="player2MarketValue" class="text-green-400 font-semibold">€--M</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400 text-sm" data-i18n="recommended_price">Recommended Price:</p>
                                        <p id="player2RecommendedPrice" class="text-blue-400 font-semibold">€--M</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400 text-sm">Estimated ROI:</p>
                                        <p id="player2ROI" class="text-purple-400 font-semibold">--%</p>
                                    </div>
                                </div>
      </div>
                
                            <!-- Player 2 Five Values -->
                            <div class="mt-4">
                                <h4 class="text-lg font-semibold text-white mb-3">The 5 Fundamental Values</h4>
                                <div class="grid grid-cols-5 gap-2">
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Marketing</p>
                                        <p id="player2Marketing" class="text-green-400 font-bold text-sm">€--M</p>
      </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Sporting</p>
                                        <p id="player2Sport" class="text-blue-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Resale</p>
                                        <p id="player2Resale" class="text-purple-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Similar</p>
                                        <p id="player2Similar" class="text-yellow-400 font-bold text-sm">€--M</p>
                                    </div>
                                    <div class="bg-gray-700 p-2 rounded text-center">
                                        <p class="text-xs text-gray-400">Market</p>
                                        <p id="player2Market" class="text-red-400 font-bold text-sm">€--M</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Player 2 Club Destino -->
                            <div class="mt-4 flex items-center gap-3">
                                <h4 class="text-sm font-semibold text-gray-300" data-i18n="destination_club">Destination Club:</h4>
                                <p id="player2ClubDestino" class="text-base font-bold text-cyan-400">--</p>
                            </div>
                            
                            <!-- Player 2 Análisis LLM -->
                            <div class="mt-4">
                                <h4 class="text-lg font-semibold text-white mb-3">Intelligent Analysis</h4>
                                <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-500/30 rounded p-3">
                                    <p id="player2LLMAnalysis" class="text-gray-300 text-sm leading-relaxed">Generating analysis...</p>
                                </div>
                            </div>
                        </div>
     </div>
    </div>

                <!-- Comparison Summary -->
                <div id="comparisonSummary" class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 hidden">
                    <h2 class="text-2xl font-bold text-white mb-4" data-i18n="comparison_summary">Comparison Summary</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="price_difference">Price Difference</h3>
                            <p id="priceDifference" class="text-2xl font-bold text-green-400">€--M</p>
    </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="better_value">Better Value</h3>
                            <p id="betterValue" class="text-xl font-bold text-blue-400">--</p>
    </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="estimated_roi">Estimated ROI</h3>
                            <p id="roiComparison" class="text-xl font-bold text-purple-400">--</p>
                        </div>
                    </div>
                </div>
     </div>
        </div>

        <!-- Reports Page -->
        <div id="reports" class="page-content">
            <div class="flex-grow p-8">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
                    <h1 class="text-4xl font-extrabold text-white" data-i18n="roi_reports">ROI Reports</h1>
                </header>

                <!-- Player Search for Report -->
                <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-white" data-i18n="generate_player_report">Generate Player Report</h2>
                        <button id="downloadPdfBtn" onclick="downloadReportPDF()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200 hidden">
                            <i class="fas fa-download mr-2"></i><span data-i18n="download_pdf">Download PDF</span>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="relative">
                            <input type="text" id="reportPlayerSearch" placeholder="Search player for report..." class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:border-green-500">
                            <div id="reportPlayerDropdown" class="absolute z-10 w-full bg-gray-700 border border-gray-600 rounded-lg mt-1 max-h-60 overflow-y-auto hidden"></div>
                        </div>
                        <button onclick="generatePlayerReport()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                            <span data-i18n="generate_report">Generate Report</span>
                        </button>
                    </div>
                </section>

                <!-- Report Results -->
                <div id="reportResults" class="hidden">
                    <!-- Player Overview -->
                    <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="player_summary">Player Summary</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 overflow-hidden">
                                    <img id="reportPlayerPhoto" class="w-full h-full object-cover rounded-full hidden" alt="Player Photo">
                                    <span id="reportPlayerInitials" class="text-white font-bold text-2xl">--</span>
                                </div>
                                <h3 id="reportPlayerName" class="text-xl font-bold text-white">--</h3>
                                <p id="reportPlayerClub" class="text-gray-400">--</p>
                                <p id="reportPlayerInfo" class="text-gray-400 text-sm">--</p>
                            </div>
                            <div class="text-center">
                                <h4 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="market_value">Market Value</h4>
                                <p id="reportMarketValue" class="text-2xl font-bold text-green-400">€--M</p>
                            </div>
                            <div class="text-center">
                                <h4 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="recommended_price">Recommended Price</h4>
                                <p id="reportRecommendedPrice" class="text-2xl font-bold text-blue-400">€--M</p>
                            </div>
                        </div>
                    </section>

                    <!-- Financial Analysis -->
                    <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="financial_analysis">Financial Analysis</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-300 mb-3" data-i18n="roi_projections">ROI Projections</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Estimated ROI:</span>
                                        <span id="reportROI" class="text-green-400 font-semibold">--%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400" data-i18n="confidence_level">Confidence Level:</span>
                                        <span id="reportConfidence" class="text-blue-400 font-semibold">--%</span>
                                    </div>
                                    
                                    <!-- NUEVOS CAMPOS DE ROI OBJETIVO -->
                                    <div id="roiBadge" class="mt-4"></div>
                                    <div id="priceComparison" class="mt-4"></div>
                                    <div id="roiRecommendation" class="mt-2 text-sm text-gray-300"></div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400" data-i18n="future_value">Future Value:</span>
                                        <span id="reportFutureValue" class="text-purple-400 font-semibold">€--M</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-300 mb-3" data-i18n="market_analysis">Market Analysis</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400" data-i18n="value_trend">Value Trend:</span>
                                        <span id="reportValueTrend" class="text-yellow-400 font-semibold">--</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400" data-i18n="market_position">Market Position:</span>
                                        <span id="reportMarketPosition" class="text-orange-400 font-semibold">--</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400" data-i18n="report_date">Report Date:</span>
                                        <span id="reportDate" class="text-gray-300 font-semibold">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Performance Metrics -->
                    <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="performance_metrics">Performance Metrics</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <h4 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="age_factor">Age Factor</h4>
                                <p id="reportAgeFactor" class="text-xl font-bold text-green-400">--</p>
                            </div>
                            <div class="text-center">
                                <h4 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="position_factor">Position Factor</h4>
                                <p id="reportPositionFactor" class="text-xl font-bold text-blue-400">--</p>
                            </div>
                            <div class="text-center">
                                <h4 class="text-lg font-semibold text-gray-300 mb-2" data-i18n="league_factor">League Factor</h4>
                                <p id="reportLeagueFactor" class="text-xl font-bold text-purple-400">--</p>
                            </div>
                        </div>
                    </section>

                    <!-- Five Values Breakdown -->
                <section class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                        <h2 class="text-2xl font-bold text-white mb-4" data-i18n="five_values_breakdown">The 5 Fundamental Values Breakdown</h2>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <div class="bg-gray-700 p-4 rounded text-center">
                                <h4 class="text-sm font-semibold text-gray-300 mb-2" data-i18n="value_marketing">Marketing Value</h4>
                                <p id="reportMarketingValue" class="text-lg font-bold text-green-400">€--M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded text-center">
                                <h4 class="text-sm font-semibold text-gray-300 mb-2" data-i18n="value_sporting">Sporting Value</h4>
                                <p id="reportSportValue" class="text-lg font-bold text-blue-400">€--M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded text-center">
                                <h4 class="text-sm font-semibold text-gray-300 mb-2" data-i18n="value_resale">Resale Value</h4>
                                <p id="reportResaleValue" class="text-lg font-bold text-purple-400">€--M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded text-center">
                                <h4 class="text-sm font-semibold text-gray-300 mb-2" data-i18n="value_similar">Similar Transfers</h4>
                                <p id="reportSimilarValue" class="text-lg font-bold text-yellow-400">€--M</p>
                            </div>
                            <div class="bg-gray-700 p-4 rounded text-center">
                                <h4 class="text-sm font-semibold text-gray-300 mb-2" data-i18n="market_value">Market Value</h4>
                                <p id="reportMarketValueBreakdown" class="text-lg font-bold text-red-400">€--M</p>
                            </div>
        </div>
                </section>
                </div>
    </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page-content">
            <div class="flex-grow p-8">
                <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-700">
                    <h1 class="text-4xl font-extrabold text-white" data-i18n="title_settings">Configuración</h1>
                </header>

                <!-- Language Settings -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                    <h2 class="text-2xl font-bold text-white mb-4" data-i18n="settings_language">Configuración de Idioma</h2>
                    <div class="flex items-center space-x-4">
                        <label class="text-gray-300" data-i18n="settings_language_label">Idioma:</label>
                        <select id="languageSelect" class="bg-gray-700 border border-gray-600 rounded-md px-4 py-2 text-white focus:outline-none focus:border-green-500">
                            <option value="es" selected>Español</option>
                            <option value="en">English</option>
                        </select>
                        <button onclick="changeLanguage()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition duration-200" data-i18n="settings_change_language">
                            Cambiar Idioma
                        </button>
                    </div>
                    <p class="text-gray-400 text-sm mt-2" data-i18n="settings_language_description">Selecciona tu idioma preferido para la interfaz</p>
                </div>

                <!-- Theme Settings -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                    <h2 class="text-2xl font-bold text-white mb-4" data-i18n="settings_theme">Configuración de Tema</h2>
                    <div class="flex items-center justify-between">
                        <div>
                            <label class="text-gray-300 block mb-2" data-i18n="settings_theme_label">Modo de Visualización:</label>
                            <p class="text-gray-400 text-sm" data-i18n="settings_theme_description">Selecciona entre tema oscuro o claro</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-gray-300" data-i18n="theme_dark">Oscuro</span>
                            <button id="themeToggle" onclick="toggleTheme()" class="relative inline-flex h-8 w-14 items-center rounded-full bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                <span id="themeToggleCircle" class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform translate-x-1"></span>
                            </button>
                            <span class="text-gray-300" data-i18n="theme_light">Claro</span>
                        </div>
                    </div>
                </div>

                <!-- System Settings -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-6">
                    <h2 class="text-2xl font-bold text-white mb-4" data-i18n="settings_system">Configuración del Sistema</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-300 mb-3" data-i18n="settings_display">Preferencias de Visualización</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-3" checked>
                                    <span class="text-gray-300" data-i18n="settings_show_millions">Mostrar valores en millones</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-3" checked>
                                    <span class="text-gray-300" data-i18n="settings_detailed_analysis">Mostrar análisis detallado</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-300 mb-3">Data Configuration</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-gray-300 text-sm">Automatic update:</label>
                                    <select class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-1 text-white text-sm mt-1">
                                        <option>Hourly</option>
                                        <option>Daily</option>
                                        <option>Weekly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-gray-300 text-sm">Analysis precision:</label>
                                    <select class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-1 text-white text-sm mt-1">
                                        <option>High (recommended)</option>
                                        <option>Medium</option>
                                        <option>Fast</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div class="bg-gray-800 p-6 rounded-lg shadow-md border border-gray-700">
                    <h2 class="text-2xl font-bold text-white mb-4">Account Settings</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-300 mb-3">Personal Information</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-gray-300 text-sm">Username:</label>
                                    <input type="text" id="settingsUsername" value="Control Panel" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white mt-1" readonly>
                                </div>
                                <div>
                                    <label class="text-gray-300 text-sm">Email:</label>
                                    <input type="email" id="settingsEmail" placeholder="user@truesign.com" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white mt-1">
                                </div>
                                <div>
                                    <label class="text-gray-300 text-sm">Role:</label>
                                    <input type="text" id="settingsRole" value="User" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white mt-1" readonly>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-300 mb-3">Security</h3>
                            <div class="space-y-3">
                                <button id="changePasswordBtn" onclick="showChangePasswordModal()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                                    Change Password
                                </button>
                                <button id="logoutBtn" onclick="logout()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition duration-200">
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
            </div>

  <script>
        // Global variables
        let clubsData = [];
        
        // Load clubs data
        fetch('/clubs')
            .then(response => response.json())
            .then(data => {
                clubsData = data;
                console.log('Clubs loaded:', clubsData.length);
                console.log('Primeros 10 clubes:', clubsData.slice(0, 10));
            })
            .catch(error => {
                console.error('Error loading clubs:', error);
            });
        
        // Landing Page Functions
        function showLoginForm() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function hideLoginForm() {
            document.getElementById('loginModal').classList.add('hidden');
        }
        

        function scrollToFeatures() {
            document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
        }

        function showLanguageSelector() {
            // Simple language toggle for landing page
            const currentLang = localStorage.getItem('landingLanguage') || 'es';
            const newLang = currentLang === 'es' ? 'en' : 'es';
            localStorage.setItem('landingLanguage', newLang);
            
            if (newLang === 'en') {
                changeLandingToEnglish();
            } else {
                changeLandingToSpanish();
            }
        }

        function changeLandingToEnglish() {
            // Hero section
            document.querySelector('#landing h1').innerHTML = `
                The Future of
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-400">
                    Transfers
                </span>
            `;
            document.querySelector('#landing .text-xl').textContent = 'TrueSign uses advanced artificial intelligence to analyze more than 92,000 real transfers and predict the optimal value of any player with 95% accuracy.';
            
            // Buttons
            const buttons = document.querySelectorAll('#landing button');
            buttons.forEach(button => {
                if (button.textContent.includes('Comenzar Análisis')) {
                    button.innerHTML = '<i class="fas fa-rocket mr-2"></i>Start Analysis';
                } else if (button.textContent.includes('Conocer Más')) {
                    button.innerHTML = '<i class="fas fa-info-circle mr-2"></i>Learn More';
                } else if (button.textContent.includes('Iniciar Sesión')) {
                    button.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Sign In';
                }
            });
            
            // Features section
            document.querySelector('#features h2').textContent = 'Why TrueSign?';
            const featureTitles = document.querySelectorAll('#features h3');
            featureTitles[0].textContent = 'Real Data';
            featureTitles[1].textContent = 'Advanced AI';
            featureTitles[2].textContent = '95% Accuracy';
            
            // How it works section
            document.querySelector('#landing section:nth-of-type(3) h2').textContent = 'How It Works';
            const stepTitles = document.querySelectorAll('#landing section:nth-of-type(3) h3');
            stepTitles[0].textContent = 'Enter Data';
            stepTitles[1].textContent = 'AI Analysis';
            stepTitles[2].textContent = 'Results';
        }

        function changeLandingToSpanish() {
            // Hero section
            document.querySelector('#landing h1').innerHTML = `
                El Futuro de las
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-400">
                    Transferencias
                </span>
            `;
            document.querySelector('#landing .text-xl').textContent = 'TrueSign utiliza inteligencia artificial avanzada para analizar más de 92,000 transferencias reales y predecir el valor óptimo de cualquier jugador con 95% de precisión.';
            
            // Buttons
            const buttons = document.querySelectorAll('#landing button');
            buttons.forEach(button => {
                if (button.textContent.includes('Start Analysis')) {
                    button.innerHTML = '<i class="fas fa-rocket mr-2"></i>Comenzar Análisis';
                } else if (button.textContent.includes('Learn More')) {
                    button.innerHTML = '<i class="fas fa-info-circle mr-2"></i>Conocer Más';
                } else if (button.textContent.includes('Sign In')) {
                    button.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión';
                }
            });
            
            // Features section
            document.querySelector('#features h2').textContent = '¿Por qué TrueSign?';
            const featureTitles = document.querySelectorAll('#features h3');
            featureTitles[0].textContent = 'Datos Reales';
            featureTitles[1].textContent = 'IA Avanzada';
            featureTitles[2].textContent = '95% Precisión';
            
            // How it works section
            document.querySelector('#landing section:nth-of-type(3) h2').textContent = 'Cómo Funciona';
            const stepTitles = document.querySelectorAll('#landing section:nth-of-type(3) h3');
            stepTitles[0].textContent = 'Ingresa Datos';
            stepTitles[1].textContent = 'Análisis IA';
            stepTitles[2].textContent = 'Resultados';
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                // Enviar credenciales al servidor para validación
                fetch('/user/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Hide landing page and show main app
                        document.getElementById('landing').classList.add('hidden');
                        document.getElementById('mainApp').classList.remove('hidden');
                        
                        // Store login state
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('username', username);
                        localStorage.setItem('userRole', data.user.role);
                        
                        // Store expiry info if available
                        if (data.expiry_info) {
                            localStorage.setItem('expiryInfo', JSON.stringify(data.expiry_info));
                            // Show expiry warning if needed
                            if (data.expiry_info.message && data.expiry_info.message.includes('⚠️')) {
                                showNotification(data.expiry_info.message, 'warning');
                            }
                        }
                        
                        // Update user display
                        updateUserDisplay(username);
                        
                        // Hide login modal
                        hideLoginForm();
                        
                        // Show success message
                        showNotification('Login exitoso! Bienvenido ' + username, 'success');
                    } else {
                        // Check if user has expired
                        if (data.expired) {
                            showNotification(data.message, 'error');
                        } else {
                            // Show secure error message without revealing credentials
                            showNotification('Usuario o contraseña incorrectos. Verifica tus credenciales e intenta nuevamente.', 'error');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Error de conexión. Verifica tu conexión a internet e intenta nuevamente.', 'error');
                });
            } else {
                showNotification('Por favor completa todos los campos requeridos.', 'warning');
            }
        }

        function logout() {
            // Show landing page and hide main app
            document.getElementById('landing').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            
            // Clear login state
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('username');
            localStorage.removeItem('userRole');
            
            // Clear expiry info
            localStorage.removeItem('expiryInfo');
            
            // Hide any expiry banner
            const expiryBanner = document.getElementById('expiryBanner');
            if (expiryBanner) {
                expiryBanner.style.display = 'none';
            }
            
            // Reset logos to default
            resetLogosToDefault();
        }

        function resetLogosToDefault() {
            const logoElements = [
                'landingLogo',
                'loginLogo', 
                'footerLogo',
                'dashboardLogo'
            ];
            
            logoElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.src = '/static/logo.png';
                    element.alt = 'TrueSign Logo';
                }
            });
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-600 text-white' : 
                type === 'error' ? 'bg-red-600 text-white' : 
                'bg-blue-600 text-white'
            }`;
            notification.textContent = message;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateUserDisplay(username) {
            // Update the user display name
            const userDisplayName = document.getElementById('userDisplayName');
            if (userDisplayName) {
                userDisplayName.textContent = username;
            }
            
            // Update the user avatar with first letter of username
            const userAvatar = document.getElementById('userAvatar');
            if (userAvatar && username) {
                const firstLetter = username.charAt(0).toUpperCase();
                userAvatar.src = `https://placehold.co/40x40/374151/FFFFFF?text=${firstLetter}`;
                userAvatar.alt = `User Avatar ${username}`;
            }
            
            // Update settings page with user info
            updateSettingsUserInfo();
            
            // Update logos based on user
            updateUserLogos(username);
            
            // Check and display expiry information
            checkAndDisplayExpiryInfo();
        }

        function checkAndDisplayExpiryInfo() {
            const expiryInfo = localStorage.getItem('expiryInfo');
            if (expiryInfo) {
                try {
                    const info = JSON.parse(expiryInfo);
                    
                    // Create or update expiry banner
                    let expiryBanner = document.getElementById('expiryBanner');
                    if (!expiryBanner) {
                        expiryBanner = document.createElement('div');
                        expiryBanner.id = 'expiryBanner';
                        expiryBanner.className = 'fixed top-0 left-0 right-0 z-50 p-4 text-center text-white font-medium';
                        
                        // Insert at the beginning of mainApp
                        const mainApp = document.getElementById('mainApp');
                        if (mainApp) {
                            mainApp.insertBefore(expiryBanner, mainApp.firstChild);
                        }
                    }
                    
                    // Update banner content based on expiry status
                    if (info.expired) {
                        expiryBanner.className = 'fixed top-0 left-0 right-0 z-50 p-4 text-center text-white font-medium bg-red-600';
                        expiryBanner.innerHTML = `
                            <div class="flex items-center justify-center space-x-2">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>${info.message}</span>
                                <button onclick="this.parentElement.parentElement.style.display='none'" class="ml-4 text-white hover:text-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    } else if (info.message && info.message.includes('⚠️')) {
                        expiryBanner.className = 'fixed top-0 left-0 right-0 z-50 p-4 text-center text-white font-medium bg-yellow-600';
                        expiryBanner.innerHTML = `
                            <div class="flex items-center justify-center space-x-2">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>${info.message}</span>
                                <button onclick="this.parentElement.parentElement.style.display='none'" class="ml-4 text-white hover:text-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    } else {
                        // Hide banner if no warning needed
                        expiryBanner.style.display = 'none';
                    }
                } catch (e) {
                    console.error('Error parsing expiry info:', e);
                }
            }
        }

        function updateUserLogos(username) {
            let logoPath = '/static/logo.png';
            
            if (username === 'TalleresDeCordoba' || 
                username === 'DireccionDeportivaCat' || 
                username === 'ScoutingCat') {
                logoPath = '/static/talleres.png';
            } else if (username === 'NacionalDeUruguay') {
                logoPath = '/static/nacional.png';
            } else if (username === "VelezSarsfield") {
                logoPath = '/static/velez.png';
            } else if (username === "Independiente") {
                logoPath = '/static/independiente.png';
            } 
            
            // Update all logo elements
            const logoElements = [
                'landingLogo',
                'loginLogo', 
                'footerLogo',
                'dashboardLogo'
            ];
            
            logoElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.src = logoPath;
                    element.alt = `${username} Logo`;
                }
            });
        }

        function updateSettingsUserInfo() {
            const username = localStorage.getItem('username');
            const userRole = localStorage.getItem('userRole');
            
            if (username) {
                // Update username in settings
                const settingsUsername = document.getElementById('settingsUsername');
                if (settingsUsername) {
                    settingsUsername.value = username;
                }
                
                // Update role in settings
                const settingsRole = document.getElementById('settingsRole');
                if (settingsRole) {
                    settingsRole.value = userRole === 'admin' ? 'Administrador' : 'Usuario';
                }
                
                // Update email if available (from user data)
                const settingsEmail = document.getElementById('settingsEmail');
                if (settingsEmail && !settingsEmail.value) {
                    // Set default email based on username
                    settingsEmail.value = username.toLowerCase() + '@truesign.com';
                }
            }
        }

        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
        }

        function hideChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            // Clear form
            document.getElementById('changePasswordForm').reset();
        }

        // changeLanguage() está definida más adelante (línea ~2856) con sistema completo de traducción

        function loadSettings() {
            // Load saved settings
            const language = localStorage.getItem('language') || 'es';
            const languageSelect = document.getElementById('languageSelect');
            if (languageSelect) {
                languageSelect.value = language;
            }
            
            // Update user info
            updateSettingsUserInfo();
        }

        function handleChangePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const username = localStorage.getItem('username');
            
            // Validate inputs
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Las contraseñas no coinciden', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('La nueva contraseña debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            // Simulate password change (in a real app, this would call the backend)
            // For now, we'll just show a success message
            showNotification('Contraseña cambiada exitosamente', 'success');
            hideChangePasswordModal();
            
            // In a real implementation, you would call the backend:
            /*
            fetch('/user/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    currentPassword: currentPassword,
                    newPassword: newPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Contraseña cambiada exitosamente', 'success');
                    hideChangePasswordModal();
                } else {
                    showNotification(data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Error al cambiar contraseña', 'error');
            });
            */
        }

        // Check login state on page load
        function checkLoginState() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                const username = localStorage.getItem('username');
                
                // Check if user has expired before showing the app
                if (username) {
                    checkUserExpiryOnLoad(username);
                } else {
                    // No username, logout
                    logout();
                }
            } else {
                document.getElementById('landing').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        }

        async function checkUserExpiryOnLoad(username) {
            try {
                const response = await fetch('/user/check-expiry', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username })
                });
                
                const data = await response.json();
                if (data.success) {
                    // Update stored expiry info
                    localStorage.setItem('expiryInfo', JSON.stringify(data.expiry_info));
                    
                    // Check if user has expired
                    if (data.expiry_info.expired) {
                        // User has expired, logout and show message
                        logout();
                        showNotification(data.expiry_info.message, 'error');
                        return;
                    }
                    
                    // User is still valid, show the app
                    document.getElementById('landing').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    // Update user display
                    updateUserDisplay(username);
                } else {
                    // Error checking expiry, logout for security
                    logout();
                    showNotification('Error verificando acceso. Por favor, inicia sesión nuevamente.', 'error');
                }
            } catch (error) {
                console.error('Error checking expiry on load:', error);
                // On error, logout for security
                logout();
                showNotification('Error de conexión. Por favor, inicia sesión nuevamente.', 'error');
            }
        }

        // Navigation function
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });
            
            // Find and activate the correct nav item
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(pageId)) {
                    item.classList.add('active');
                }
            });
        }

        // Search player function for different pages
        async function searchPlayerFromPage(pageId) {
            const playerName = document.getElementById('playerSearch2').value;
            const clubName = document.getElementById('clubDestino').value || 'CA Independiente';
            const roiTarget = document.getElementById('roiTarget').value;
            const clubDestino = document.getElementById('clubDestino').value;
            
            if (!playerName) {
                alert('Por favor ingresa el nombre del jugador');
                return;
            }
            
            // Show loading state
            const resultsSection = document.getElementById('resultsSection2');
            resultsSection.classList.remove('hidden');
            
            const playerInfoCard = document.getElementById('playerInfoCard2');
            const analysisCard = document.getElementById('analysisCard2');
            
            playerInfoCard.innerHTML = `
                <div class="skeleton-loading h-32 rounded-lg"></div>
            `;
            
            analysisCard.innerHTML = `
                <div class="skeleton-loading h-32 rounded-lg"></div>
            `;
            
            try {
                const currentLanguage = localStorage.getItem('language') || 'es';
                const response = await fetch(`/search?name=${encodeURIComponent(playerName)}&club=${encodeURIComponent(clubName)}&roi_target=${encodeURIComponent(roiTarget)}&language=${currentLanguage}`);
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                return;
            }
            
                // Display player info
                const playerInfo = data.player;
                // Generar iniciales del nombre
                const generateInitials = (name) => {
                    if (!name) return '--';
                    return name.split(' ').map(word => word.charAt(0)).join('').toUpperCase();
                };
                
                // Formatear pie hábil
                const formatFoot = (foot) => {
                    if (foot === 1) return 'Diestro';
                    if (foot === 2) return 'Zurdo';
                    if (foot === 3) return 'Ambidiestro';
                    return '--';
                };
                
                // Formatear altura
                const formatHeight = (height) => {
                    if (!height || height === 1 || height === '1') return '--';
                    if (typeof height === 'string' && height.includes('m')) {
                        return height; // Ya está formateado como "1,95 m"
                    }
                    return `${height} cm`;
                };
                
                playerInfoCard.innerHTML = `
                    <div class="flex items-center space-x-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center">
                            <span class="text-white font-bold text-xl">${generateInitials(playerInfo.player_name || playerInfo.name)}</span>
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-2xl font-bold text-white">${playerInfo.player_name || playerInfo.name || 'N/A'}</h3>
                            <p class="text-gray-400">${playerInfo.current_club_name || playerInfo.current_club || playerInfo.club || 'Sin club'}</p>
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <div>
                                    <p class="text-gray-400 text-sm">${formatPosition(playerInfo.position)} • ${playerInfo.age && playerInfo.age > 0 ? playerInfo.age : '25'} años</p>
                                    <p class="text-gray-400 text-sm">Altura: ${formatHeight(playerInfo.height)}</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 text-sm">Pie hábil: ${formatFoot(playerInfo.foot)}</p>
                                    <p class="text-green-400 font-semibold">Valor: €${formatValue(playerInfo.market_value)}M</p>
                                </div>
                            </div>
                        </div>
                        </div>
                    `;
                
                // Display analysis
                const analysis = data.truesign_analysis;
                
                // Calcular ROI objetivo (usar la variable roiTarget ya declarada arriba)
                const roiTargetValue = parseFloat(roiTarget) || 30;
                const roiPredicho = analysis.roi_estimate?.percentage || 0;
                const precioMaximo = analysis.precio_maximo || analysis.fair_price || 0;
                const valorFuturo = analysis.resale_value || 0;
                const precioParaROI = valorFuturo > 0 ? valorFuturo / (1 + roiTargetValue / 100) : 0;
                const cumpleObjetivo = roiPredicho >= roiTargetValue;
                
                const currentLang = localStorage.getItem('language') || 'es';
                const trans = translations[currentLang];
                
                // Verificar estado del sistema
                const systemStatus = await checkSystemStatus();
                
                analysisCard.innerHTML = `
                    <!-- Indicador de Estado del Sistema -->
                    <div class="mb-4 p-3 rounded-lg bg-green-900/20 border border-green-500">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                <span class="text-sm font-medium text-green-300">
                                    Modelo Híbrido 2025 Activo
                                </span>
                            </div>
                            <button onclick="testSystemModel()" class="text-xs px-2 py-1 rounded bg-green-600 hover:bg-green-700 text-white">
                                Probar Modelo
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2">${trans.recommended_price || 'Precio Máximo Recomendado'}</h3>
                            <p class="text-3xl font-bold text-green-400">€${formatValue(analysis.precio_maximo || analysis.fair_price)}M</p>
                        </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2">${trans.confidence || 'Confianza'}</h3>
                            <p class="text-3xl font-bold text-blue-400">${analysis.confidence || '--'}%</p>
                        </div>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-gray-300 mb-2">${trans.roi_estimate || 'ROI Estimado'}</h3>
                            <p class="text-3xl font-bold text-purple-400">${analysis.roi_estimate?.percentage || '--'}%</p>
                        </div>
                    </div>
                    
                `;
                
                // Update 5 values
                updateFiveValuesFromPage(analysis);
                
                // Update similar transfers info
                updateMLPredictionFromPage(data);
                
                // Update club analysis
                updateClubAnalysis(clubName);
                
                // Aplicar traducciones al contenido dinámico
                const savedLang = localStorage.getItem('language') || 'es';
                applyTranslations(savedLang);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar el jugador');
            }
        }

        // Update 5 values for different pages
        function updateFiveValuesFromPage(analysis) {
            // Usar los 5 valores directamente del backend
            const fiveValues = analysis.five_values || {};
            
            const marketingValue = formatValue(fiveValues.marketing_impact || 0);
            const sportValue = formatValue(fiveValues.sporting_value || 0);
            const resaleValue = formatValue(fiveValues.resale_potential || 0);
            const similarValue = formatValue(fiveValues.similar_transfers || 0);
            const marketValue = formatValue(fiveValues.market_value || 0);
            
            // Verificar que los elementos existen
            const marketingEl = document.getElementById('marketingValue2');
            const sportEl = document.getElementById('sportValue2');
            const resaleEl = document.getElementById('resaleValue2');
            const similarEl = document.getElementById('similarTransfersValue2');
            const marketEl = document.getElementById('marketValuesValue2');
            
            if (marketingEl) marketingEl.textContent = `€${marketingValue}M`;
            if (sportEl) sportEl.textContent = `€${sportValue}M`;
            if (resaleEl) resaleEl.textContent = `€${resaleValue}M`;
            if (similarEl) similarEl.textContent = `€${similarValue}M`;
            if (marketEl) marketEl.textContent = `€${marketValue}M`;
        }

        // Update ML prediction info
        function updateMLPredictionFromPage(data) {
            // Obtener datos del análisis
            const analysis = data.truesign_analysis;
            const performanceAnalysis = analysis.performance_analysis || {};
            const predictedChange = parseFloat(analysis.predicted_change?.percentage) || 0;
            const confidence = parseFloat(analysis.confidence) || 0;
            const marketValue = parseFloat(data.market_value) || 0;
            
            // Usar valores del backend directamente
            const resaleValue = parseFloat(analysis.resale_value) || 0;
            const roiEstimate = parseFloat(analysis.roi_estimate?.percentage) || 0;
            
            // Usar resale_value del backend como valor futuro
            const futureValue = resaleValue > 0 ? resaleValue : marketValue * (1 + predictedChange / 100);
            
            // Formatear valores
            const changeText = predictedChange >= 0 ? `+${predictedChange.toFixed(1)}%` : `${predictedChange.toFixed(1)}%`;
            const futureValueText = `€${(futureValue / 1_000_000).toFixed(1)}M`;
            const confidenceText = `${confidence.toFixed(0)}%`;
            
            // Actualizar elementos
            safeUpdateElement('predictedChange', changeText);
            console.log('Actualizando futureValue con:', futureValueText);
            safeUpdateElement('futureValue', futureValueText);
            safeUpdateElement('predictionConfidence', confidenceText);
            // Usar club destino real del response
            const clubDestino = data.club_destino || document.getElementById('clubDestino')?.value || 'Análisis general';
            safeUpdateElement('clubDestinoDisplay', clubDestino);
            
            // Mostrar análisis LLM si está disponible
            const analysisText = data.analysis_text || 'Análisis no disponible.';
            const llmElement = document.getElementById('llmAnalysisText');
            if (llmElement) {
                llmElement.textContent = analysisText;
                // Quitar data-i18n para que no se traduzca automáticamente
                llmElement.removeAttribute('data-i18n');
            }
            
            // Colorear según el cambio
            const changeElement = document.getElementById('predictedChange');
            if (changeElement) {
                if (predictedChange > 10) {
                    changeElement.className = 'text-xl font-bold text-green-400';
                } else if (predictedChange > 0) {
                    changeElement.className = 'text-xl font-bold text-blue-400';
                } else if (predictedChange > -10) {
                    changeElement.className = 'text-xl font-bold text-yellow-400';
                } else {
                    changeElement.className = 'text-xl font-bold text-red-400';
                }
            }
        }

        // Search player function
        async function searchPlayer() {
            const playerName = document.getElementById('playerSearch').value;
            const clubName = document.getElementById('clubSearch').value;
            
            if (!playerName) {
                alert('Por favor ingresa el nombre del jugador');
                return;
            }
            
            // Show loading state
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.remove('hidden');
            
            const playerInfoCard = document.getElementById('playerInfoCard');
            const analysisCard = document.getElementById('analysisCard');
            
            playerInfoCard.innerHTML = `
                <div class="skeleton-loading h-32 rounded-lg"></div>
            `;
            
            analysisCard.innerHTML = `
                <div class="skeleton-loading h-64 rounded-lg"></div>
            `;
            
            try {
                const response = await fetch(`/search?name=${encodeURIComponent(playerName)}&club=${encodeURIComponent(clubName)}`);
                const data = await response.json();
                console.log('✅ Player data received:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Display player info
                const playerInfo = data.player;
                const analysis = data.truesign_analysis;
                
                console.log('📊 Analysis data:', analysis);
                // Debug: Log player info to see what we have
                console.log('👤 Player info:', playerInfo);
                
                playerInfoCard.innerHTML = `
                    <div class="flex items-center space-x-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                            ${(playerInfo.player_name || playerInfo.name || '??').split(' ').map(n => n[0]).join('')}
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold text-white">${playerInfo.player_name || playerInfo.name || 'Jugador'}</h3>
                            <p class="text-gray-400">${playerInfo.current_club_name || playerInfo.current_club || playerInfo.club || 'Club desconocido'}</p>
                            <div class="flex items-center space-x-4 mt-2">
                                <span class="text-sm text-gray-300">Edad: ${playerInfo.age && playerInfo.age > 0 ? playerInfo.age : '25'}</span>
                                <span class="text-sm text-gray-300">Posición: ${formatPosition(playerInfo.position)}</span>
                                <span class="text-sm text-gray-300">Valor: €${formatValue(playerInfo.market_value || 0)}M</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Display analysis
                analysisCard.innerHTML = `
                    <h3 class="text-xl font-bold text-white mb-4">Análisis TrueSign</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div class="text-3xl font-bold text-green-400 mb-2">€${formatValue(analysis.fair_price || 0)}M</div>
                            <div class="text-gray-300">Precio Máximo Recomendado</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-blue-400 mb-2">${analysis.confidence || '0'}%</div>
                            <div class="text-gray-300">Confianza</div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <div class="text-lg font-semibold text-white mb-2">ROI Estimado</div>
                        <div class="text-2xl font-bold text-green-400">${formatROI(analysis.roi_percentage)}%</div>
                        <div class="text-gray-400 text-sm">Retorno de inversión esperado</div>
                        </div>
                    `;
                
                // Update the 5 values
                // Debug: Log the data to see what we're receiving
                console.log('📊 Data received from backend:', data);
                console.log('📊 Analysis data:', analysis);
                
                // Update the 5 fundamental values
                updateFiveValues(analysis);
                
                // Update club analysis
                updateClubAnalysis(clubName);
                
            } catch (error) {
                console.error('Error:', error);
                playerInfoCard.innerHTML = `
                    <div class="text-center text-red-400">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p>Error al buscar el jugador: ${error.message}</p>
                </div>
                `;
                analysisCard.innerHTML = '';
            }
        }

        // Update the 5 fundamental values
        function updateFiveValues(data) {
            console.log('Updating 5 values with data:', data);
            
            // Usar los 5 valores directamente del backend
            const fiveValues = data.five_values || {};
            
            console.log('Five values from backend:', fiveValues);
            
            // Extract raw values first to debug
            const rawMarketing = fiveValues.marketing_value || 0;
            const rawSport = fiveValues.sport_value || 0;
            const rawResale = fiveValues.resale_value || 0;
            const rawSimilar = fiveValues.similar_transfers_value || 0;
            const rawMarket = fiveValues.different_market_values || 0;
            
            console.log('Raw values from backend:', {
                marketing: rawMarketing,
                sport: rawSport,
                resale: rawResale,
                similar: rawSimilar,
                market: rawMarket
            });
            
            // Format values properly
            const marketingValue = formatValue(rawMarketing);
            const sportValue = formatValue(rawSport);
            const resaleValue = formatValue(rawResale);
            const similarTransfersValue = formatValue(rawSimilar);
            const marketValuesValue = formatValue(rawMarket);
            
            console.log('📈 Values found:', {
                marketing: marketingValue,
                sport: sportValue,
                resale: resaleValue,
                similar: similarTransfersValue,
                market: marketValuesValue,
                detailedValues: detailedValues
            });
            
            document.getElementById('marketingValue').textContent = `€${marketingValue}M`;
            document.getElementById('sportValue').textContent = `€${sportValue}M`;
            document.getElementById('resaleValue').textContent = `€${resaleValue}M`;
            document.getElementById('similarTransfersValue').textContent = `€${similarTransfersValue}M`;
            document.getElementById('marketValuesValue').textContent = `€${marketValuesValue}M`;
        }

        // Format value to proper millions format with realistic limits
        function formatValue(value) {
            if (!value || value === 0) return '0';
            
            // Convert to number if it's a string
            const numValue = typeof value === 'string' ? parseFloat(value) : value;
            
            // If the value is NaN or invalid, return 0
            if (isNaN(numValue)) return '0';
            
            // If the value is already in millions (less than 1000), use as is
            if (numValue < 1000) {
                return numValue.toFixed(1);
            }
            
            // If the value is in raw format (like 15000000), convert to millions
            return (numValue / 1000000).toFixed(1);
        }

        // Format position to readable text
        function formatPosition(position) {
            if (!position || position === '1' || position === 1) return '--';
            
            // Obtener idioma actual
            const currentLang = localStorage.getItem('language') || 'es';
            
            const positionMap = {
                // Abreviaturas
                'GK': 'Portero',
                'CB': 'Defensor Central',
                'LB': 'Lateral Izquierdo',
                'RB': 'Lateral Derecho',
                'CDM': 'Mediocampista Defensivo',
                'CM': 'Mediocampista',
                'CAM': 'Mediocampista Ofensivo',
                'LW': 'Extremo Izquierdo',
                'RW': 'Extremo Derecho',
                'ST': 'Delantero',
                'CF': 'Delantero Centro',
                'LM': 'Mediocampista Izquierdo',
                'RM': 'Mediocampista Derecho'
            };
            
            // Si es una abreviatura, usar el mapa
            if (positionMap[position]) {
                return positionMap[position];
            }
            
            // Si es una posición completa, traducir usando el diccionario de traducciones
            if (currentLang === 'es' && translations.es[position]) {
                return translations.es[position];
            }
            
            return position;
        }

        // Format foot to readable text
        function formatFoot(foot) {
            if (!foot || foot === '--' || foot === 'nan' || foot === 'None') return 'Derecho';
            
            const footMap = {
                'Right': 'Derecho',
                'Derecho': 'Derecho',
                'right': 'Derecho',
                'Left': 'Izquierdo',
                'Izquierdo': 'Izquierdo',
                'left': 'Izquierdo',
                'Both': 'Ambidiestro',
                'Ambos': 'Ambidiestro',
                'both': 'Ambidiestro'
            };
            
            return footMap[foot] || foot;
        }

        // Format height to readable text
        function formatHeight(height) {
            if (!height || height === '--' || height === 0) return '178 cm';
            
            // Si ya viene con "cm", devolverlo tal cual
            if (typeof height === 'string' && height.includes('cm')) {
                return height;
            }
            
            // Si es un número, agregar "cm"
            const numHeight = typeof height === 'string' ? parseFloat(height) : height;
            if (isNaN(numHeight)) return '178 cm';
            
            return `${Math.round(numHeight)} cm`;
        }

        // Format ROI percentage
        function formatROI(roi) {
            if (!roi || roi === 0) return '0.0';
            const numValue = typeof roi === 'string' ? parseFloat(roi) : roi;
            if (isNaN(numValue)) return '0.0';
            return numValue.toFixed(1);
        }

        // Safe element update helper
        function safeUpdateElement(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = content;
                console.log(`Elemento ${elementId} actualizado con: ${content}`);
            } else {
                console.log(`Elemento ${elementId} no encontrado`);
            }
        }

        // Update club analysis
        function updateClubAnalysis(clubName) {
            if (clubName) {
                safeUpdateElement('selectedClub', clubName);
                safeUpdateElement('clubAnalysis', `Análisis específico para ${clubName}: El jugador se adaptará al estilo de juego del club y llenará las necesidades tácticas identificadas.`);
                safeUpdateElement('clubSpecificAnalysis', `El análisis considera el nivel del club ${clubName}, su historial de ROI y su capacidad financiera para determinar el precio óptimo.`);
            } else {
                safeUpdateElement('selectedClub', 'Ninguno');
                safeUpdateElement('clubAnalysis', 'Selecciona un club de destino para ver el análisis específico de ajuste táctico y necesidad del equipo.');
                safeUpdateElement('clubSpecificAnalysis', 'El análisis considera el nivel del club, su historial de ROI y su capacidad financiera para determinar el precio óptimo.');
            }
        }

        // Generate report function
        function generateReport() {
            const playerName = document.getElementById('playerSearch').value;
            const clubName = document.getElementById('clubSearch').value;
            
            if (!playerName) {
                alert('Por favor busca un jugador primero');
                return;
            }
            
            showPage('reports');
        }

        // Generate player report function
        async function generatePlayerReport() {
            const playerName = document.getElementById('reportPlayerSearch').value;
            
            if (!playerName) {
                alert('Por favor ingresa el nombre del jugador');
                return;
            }

            // Mostrar indicador de carga
            const reportResults = document.getElementById('reportResults');
            const generateBtn = document.querySelector('button[onclick="generatePlayerReport()"]');
            
            // Deshabilitar botón y mostrar carga
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generating...';
            
            reportResults.classList.remove('hidden');

            try {
                const response = await fetch(`/report/${encodeURIComponent(playerName)}`);
                const data = await response.json();
                
                // Restaurar botón
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'Generate Report';
                
                if (data.error) {
                    alert(data.error);
                    reportResults.classList.add('hidden');
                    return;
                }
                // Actualizar datos del jugador
                const playerInfo = data.player_info;
                const analysis = data.analysis;
                const breakdown = data.detailed_breakdown;
                
                // Obtener idioma actual
                const currentLang = localStorage.getItem('language') || 'es';
                
                // Información básica
                document.getElementById('reportPlayerName').textContent = playerInfo.player_name || '--';
                document.getElementById('reportPlayerClub').textContent = playerInfo.current_club_name || '--';
                
                // Traducir posición
                const position = playerInfo.position || '--';
                const positionTranslated = currentLang === 'es' && translations.es[position] ? translations.es[position] : position;
                
                document.getElementById('reportPlayerInfo').textContent = `${playerInfo.age && playerInfo.age > 0 ? playerInfo.age : '25'} años, ${positionTranslated}`;
                
                // Foto del jugador o iniciales
                const photoUrl = playerInfo.photo_url;
                const photoElement = document.getElementById('reportPlayerPhoto');
                const initialsElement = document.getElementById('reportPlayerInitials');
                
                if (photoUrl && photoUrl !== '') {
                    photoElement.src = photoUrl;
                    photoElement.classList.remove('hidden');
                    initialsElement.classList.add('hidden');
                } else {
                    const initials = (playerInfo.player_name || '').split(' ').map(n => n[0]).join('').substring(0, 2);
                    initialsElement.textContent = initials || '--';
                    photoElement.classList.add('hidden');
                    initialsElement.classList.remove('hidden');
                }
                
                // Valores financieros
                const marketValue = (playerInfo.market_value || 0) / 1000000;
                const recommendedPrice = (breakdown.financial_projections.recommended_price || 0) / 1000000;
                const futureValue = (breakdown.financial_projections.future_value || 0) / 1000000;
                const roiPercentage = breakdown.financial_projections.roi_estimate || 0;
                const confidence = breakdown.financial_projections.confidence_level || 0;
                
                document.getElementById('reportMarketValue').textContent = `€${marketValue.toFixed(1)}M`;
                document.getElementById('reportRecommendedPrice').textContent = `€${recommendedPrice.toFixed(1)}M`;
                document.getElementById('reportFutureValue').textContent = `€${futureValue.toFixed(1)}M`;
                document.getElementById('reportROI').textContent = `${roiPercentage.toFixed(1)}%`;
                document.getElementById('reportConfidence').textContent = `${confidence.toFixed(0)}%`;
                
                // ===== ROI OBJETIVO =====
                const roiTarget = 30; // ROI objetivo fijo
                const precioMaximo = recommendedPrice * 1000000;
                const valorFuturo = futureValue * 1000000;
                const precioParaROI = valorFuturo / (1 + roiTarget / 100);
                const cumpleObjetivo = roiPercentage >= roiTarget;
                
                // Mostrar badge de cumplimiento
                const roiBadge = document.getElementById('roiBadge');
                if (roiBadge) {
                    if (cumpleObjetivo) {
                        roiBadge.innerHTML = `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">✅ Cumple objetivo de ROI (${roiTarget}%)</span>`;
                    } else {
                        roiBadge.innerHTML = `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800">⚠️ No alcanza objetivo de ROI (${roiTarget}%)</span>`;
                    }
                }
                
                // Mostrar comparación de precios
                const priceComparison = document.getElementById('priceComparison');
                if (priceComparison) {
                    priceComparison.innerHTML = `
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-700 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-300 mb-2">Precio ML</h4>
                                <p class="text-2xl font-bold text-blue-400">€${recommendedPrice.toFixed(1)}M</p>
                                <p class="text-xs text-gray-400">ROI: ${roiPercentage.toFixed(1)}%</p>
                            </div>
                            <div class="bg-purple-900 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-300 mb-2">Para ROI ${roiTarget}%</h4>
                                <p class="text-2xl font-bold text-purple-400">€${(precioParaROI / 1000000).toFixed(1)}M</p>
                                <p class="text-xs text-gray-400">Máximo a pagar</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <p class="text-sm text-gray-300">💡 Para lograr ${roiTarget}% ROI, negocia máximo €${(precioParaROI / 1000000).toFixed(1)}M</p>
                        </div>
                    `;
                }
                
                // Mostrar recomendación
                const roiRecommendation = document.getElementById('roiRecommendation');
                if (roiRecommendation) {
                    roiRecommendation.textContent = `Para lograr ${roiTarget}% ROI, negocia máximo €${(precioParaROI/1000000).toFixed(1)}M`;
                }
                
                // Análisis de mercado - con traducción
                const valueTrend = breakdown.market_value_analysis.value_trend;
                const marketPosition = breakdown.market_value_analysis.market_position;
                
                // Traducir si es necesario
                const trendTranslated = currentLang === 'es' && translations.es[valueTrend] ? translations.es[valueTrend] : valueTrend;
                const marketPositionTranslated = currentLang === 'es' && translations.es[marketPosition] ? translations.es[marketPosition] : marketPosition;
                
                document.getElementById('reportValueTrend').textContent = trendTranslated;
                document.getElementById('reportMarketPosition').textContent = marketPositionTranslated;
                document.getElementById('reportDate').textContent = new Date(data.report_generated).toLocaleDateString();
                
                // Métricas de rendimiento - con descripción visual
                const ageFactor = breakdown.performance_metrics.age_factor || 0;
                const positionFactor = breakdown.performance_metrics.position_factor || 0;
                const leagueFactor = breakdown.performance_metrics.league_factor || 0;
                
                // Función para generar descripción de factor
                const getFactorDescription = (value) => {
                    if (value >= 90) return currentLang === 'es' ? 'Excelente' : 'Excellent';
                    if (value >= 80) return currentLang === 'es' ? 'Muy Bueno' : 'Very Good';
                    if (value >= 70) return currentLang === 'es' ? 'Bueno' : 'Good';
                    if (value >= 60) return currentLang === 'es' ? 'Regular' : 'Fair';
                    return currentLang === 'es' ? 'Bajo' : 'Low';
                };
                
                // Función para color del factor
                const getFactorColor = (value) => {
                    if (value >= 90) return 'text-green-400';
                    if (value >= 80) return 'text-blue-400';
                    if (value >= 70) return 'text-yellow-400';
                    return 'text-orange-400';
                };
                
                document.getElementById('reportAgeFactor').innerHTML = `
                    <span class="${getFactorColor(ageFactor)}">${ageFactor}</span>
                    <span class="text-xs text-gray-400 block mt-1">${getFactorDescription(ageFactor)}</span>
                `;
                document.getElementById('reportPositionFactor').innerHTML = `
                    <span class="${getFactorColor(positionFactor)}">${positionFactor}</span>
                    <span class="text-xs text-gray-400 block mt-1">${getFactorDescription(positionFactor)}</span>
                `;
                document.getElementById('reportLeagueFactor').innerHTML = `
                    <span class="${getFactorColor(leagueFactor)}">${leagueFactor}</span>
                    <span class="text-xs text-gray-400 block mt-1">${getFactorDescription(leagueFactor)}</span>
                `;
                
                // Los 5 valores - usar los nombres correctos del modelo híbrido 2025
                const fiveValues = breakdown.five_values || {};
                document.getElementById('reportMarketingValue').textContent = `€${((fiveValues.marketing_impact || 0) / 1000000).toFixed(1)}M`;
                document.getElementById('reportSportValue').textContent = `€${((fiveValues.sporting_value || 0) / 1000000).toFixed(1)}M`;
                document.getElementById('reportResaleValue').textContent = `€${((fiveValues.resale_potential || 0) / 1000000).toFixed(1)}M`;
                document.getElementById('reportSimilarValue').textContent = `€${((fiveValues.similar_transfers || 0) / 1000000).toFixed(1)}M`;
                document.getElementById('reportMarketValueBreakdown').textContent = `€${((fiveValues.market_value || 0) / 1000000).toFixed(1)}M`;
                
                // Mostrar botón de descarga PDF
                document.getElementById('downloadPdfBtn').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al generar el reporte');
                // Restaurar botón en caso de error
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'Generate Report';
                reportResults.classList.add('hidden');
            }
        }
        
        // Función para descargar reporte en PDF
        function downloadReportPDF() {
            const currentLang = localStorage.getItem('language') || 'es';
            const playerName = document.getElementById('reportPlayerName').textContent || 'Player';
            const fileName = `TrueSign_Report_${playerName.replace(/\s+/g, '_')}.pdf`;
            
            // Configuración del PDF
            const opt = {
                margin: 10,
                filename: fileName,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, backgroundColor: '#0d1117' },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Clonar el contenido para el PDF
            const element = document.getElementById('reportResults').cloneNode(true);
            
            // Crear contenedor temporal con estilos para PDF
            const pdfContainer = document.createElement('div');
            pdfContainer.style.padding = '20px';
            pdfContainer.style.backgroundColor = '#ffffff';
            pdfContainer.style.color = '#000000';
            
            // Agregar título del reporte
            const title = document.createElement('div');
            title.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #000;">
                    <h1 style="font-size: 24px; font-weight: bold; color: #000;">TrueSign - ${currentLang === 'es' ? 'Reporte de Jugador' : 'Player Report'}</h1>
                    <p style="color: #666; font-size: 14px;">${new Date().toLocaleDateString()}</p>
                </div>
            `;
            pdfContainer.appendChild(title);
            
            // Agregar contenido del reporte con estilos para PDF
            element.querySelectorAll('*').forEach(el => {
                el.style.color = '#000000';
                if (el.classList.contains('bg-gray-800') || el.classList.contains('bg-gray-700')) {
                    el.style.backgroundColor = '#f5f5f5';
                    el.style.border = '1px solid #ddd';
                }
            });
            
            pdfContainer.appendChild(element);
            document.body.appendChild(pdfContainer);
            
            // Generar PDF
            html2pdf().set(opt).from(pdfContainer).save().then(() => {
                // Limpiar contenedor temporal
                document.body.removeChild(pdfContainer);
            });
        }

        // Compare players function
        function comparePlayers() {
            showPage('compare');
        }

        // Autocomplete functionality
        let autocompleteTimeout;
        if (document.getElementById('playerSearch')) {
            document.getElementById('playerSearch').addEventListener('input', function(e) {
            clearTimeout(autocompleteTimeout);
            const query = e.target.value;
            
            if (query.length < 2) {
                document.getElementById('autocompleteDropdown').classList.add('hidden');
                return;
            }
            
            autocompleteTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/autocomplete?q=${encodeURIComponent(query)}`);
                    const suggestions = await response.json();
                    
        const dropdown = document.getElementById('autocompleteDropdown');
                    if (suggestions.length > 0) {
            dropdown.innerHTML = suggestions.map(suggestion => {
                                // Manejar tanto strings simples como objetos
                                if (typeof suggestion === 'string') {
                                    return `<div class="p-3 hover:bg-gray-600 cursor-pointer text-white" onclick="selectPlayer('${suggestion}')">
                                        ${suggestion}
                                    </div>`;
                                } else {
                                    // Nuevo formato con club y nacionalidad
                                    const displayName = suggestion.name || suggestion;
                                    const displayText = suggestion.display || `${suggestion.name} (${suggestion.club} • ${suggestion.nationality})`;
                                    return `<div class="p-3 hover:bg-gray-600 cursor-pointer text-white" onclick="selectPlayer('${displayName}')">
                                        <div class="font-bold">${suggestion.name}</div>
                                        <div class="text-sm text-gray-400">${suggestion.club} • ${suggestion.nationality}</div>
                                    </div>`;
                                }
                            }).join('');
        dropdown.classList.remove('hidden');
            } else {
            dropdown.classList.add('hidden');
        }
                } catch (error) {
                    console.error('Autocomplete error:', error);
                }
            }, 300);
        });
        }

        // Select player from autocomplete
        function selectPlayer(playerName) {
            const playerSearch = document.getElementById('playerSearch');
            const autocompleteDropdown = document.getElementById('autocompleteDropdown');
            if (playerSearch) playerSearch.value = playerName;
            if (autocompleteDropdown) autocompleteDropdown.classList.add('hidden');
        }

        // Hide autocomplete when clicking outside
        document.addEventListener('click', function(e) {
            const autocompleteDropdown = document.getElementById('autocompleteDropdown');
            if (autocompleteDropdown && !e.target.closest('#playerSearch') && !e.target.closest('#autocompleteDropdown')) {
                autocompleteDropdown.classList.add('hidden');
            }
        });

        // Club search functionality
        let clubTimeout;
        if (document.getElementById('clubSearch')) {
            document.getElementById('clubSearch').addEventListener('input', function(e) {
            clearTimeout(clubTimeout);
            const query = e.target.value;
            
            if (query.length < 2) {
                document.getElementById('clubDropdown').classList.add('hidden');
                return;
            }
            
            clubTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`/clubs?q=${encodeURIComponent(query)}`);
                    const clubs = await response.json();
                    
                    const dropdown = document.getElementById('clubDropdown');
                    if (clubs.length > 0) {
                        dropdown.innerHTML = clubs.map(club => {
                            const clubName = typeof club === 'string' ? club : club.name;
                            const displayText = typeof club === 'string' ? club : club.display;
                            return `
                                <div class="p-3 hover:bg-gray-600 cursor-pointer text-white border-b border-gray-600 last:border-b-0" onclick="selectClub('${clubName}')">
                                    <div class="font-medium">${clubName}</div>
                                    ${typeof club !== 'string' ? `
                                        <div class="text-sm text-gray-400">${club.country} - ${club.market_value}</div>
                                        <div class="text-xs text-green-400 mt-1">
                                            ${club.classification} • ${club.squad_analysis} • Potencial: ${club.transfer_potential || 'N/A'}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('');
                        dropdown.classList.remove('hidden');
                    } else {
                        dropdown.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Club search error:', error);
                }
            }, 300);
        });
        }
            
        // Select club from dropdown
        function selectClub(clubName) {
            const clubSearch = document.getElementById('clubSearch');
            const clubDropdown = document.getElementById('clubDropdown');
            if (clubSearch) clubSearch.value = clubName;
            if (clubDropdown) clubDropdown.classList.add('hidden');
            updateClubAnalysis(clubName);
            loadClubInfo(clubName);
        }
        
        // Load additional club information
        async function loadClubInfo(clubName) {
            try {
                const response = await fetch(`/clubs/${encodeURIComponent(clubName)}`);
                if (response.ok) {
                    const clubInfo = await response.json();
                    console.log('Club info loaded:', clubInfo);
                    
                    // Actualizar información del club en la interfaz si existe
                    const clubInfoElement = document.getElementById('clubInfo');
                    if (clubInfoElement) {
                        clubInfoElement.innerHTML = `
                            <div class="bg-gray-800 p-4 rounded-lg">
                                <h3 class="text-lg font-semibold text-white mb-2">${clubInfo.name}</h3>
                                <div class="text-sm text-gray-300 space-y-1">
                                    <p><strong>País:</strong> ${clubInfo.country}</p>
                                    <p><strong>Valor de mercado:</strong> ${clubInfo.formatted_market_value}</p>
                                    <p><strong>Plantilla:</strong> ${clubInfo.squad} jugadores</p>
                                    <p><strong>Clasificación:</strong> <span class="text-blue-400">${clubInfo.classification}</span></p>
                                    <p><strong>Análisis de plantilla:</strong> <span class="text-yellow-400">${clubInfo.squad_analysis}</span></p>
                                    <p><strong>Potencial de transferencia:</strong> <span class="text-green-400">${clubInfo.transfer_potential}</span></p>
                                    <p><strong>Factor económico:</strong> ${clubInfo.economic_factor}x</p>
                                    <p><strong>Factor de liga:</strong> ${clubInfo.league_factor}x</p>
                                </div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading club info:', error);
            }
        }

        // Hide club dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const clubDropdown = document.getElementById('clubDropdown');
            if (clubDropdown && !e.target.closest('#clubSearch') && !e.target.closest('#clubDropdown')) {
                clubDropdown.classList.add('hidden');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 TrueSign initialized');
            
            // Las traducciones se inicializan automáticamente desde translations.js
            
            // Initialize landing page
            checkLoginState();
            
            // Load settings
            loadSettings();
            
            // Setup club search
            if (document.getElementById('clubDestino') && document.getElementById('clubDestinoDropdown')) {
                initializeClubSearchForPage('clubDestino', 'clubDestinoDropdown');
            }
            
            // Add login form submit handler
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    login();
                });
            }
            
            // Add change password form submit handler
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleChangePassword();
                });
            }
            
            // Initialize autocomplete for search page if elements exist
            if (document.getElementById('playerSearch2') && document.getElementById('autocompleteDropdown2')) {
                initializeAutocompleteForPage('playerSearch2', 'autocompleteDropdown2');
            }
            if (document.getElementById('clubSearch2') && document.getElementById('clubDropdown2')) {
                initializeClubSearchForPage('clubSearch2', 'clubDropdown2');
            }
            
            // Initialize autocomplete for compare page if elements exist
            initializeComparePage();
            
            // Initialize autocomplete for reports page if elements exist
            if (document.getElementById('reportPlayerSearch')) {
                initializeAutocompleteForPage('reportPlayerSearch', 'reportPlayerDropdown');
            }
            
            // Load saved language preference - Manejado por translations.js
            // La inicialización se hace en translations.js y en DOMContentLoaded más arriba
            
            // Initialize periodic expiry check
            initializeExpiryCheck();
        });

        // Initialize periodic expiry check
        function initializeExpiryCheck() {
            // Check expiry status every 5 minutes
            setInterval(async () => {
                const username = localStorage.getItem('username');
                const isLoggedIn = localStorage.getItem('isLoggedIn');
                
                if (isLoggedIn === 'true' && username) {
                    try {
                        const response = await fetch('/user/check-expiry', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ username: username })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            // Update stored expiry info
                            localStorage.setItem('expiryInfo', JSON.stringify(data.expiry_info));
                            
                            // Check if user has expired
                            if (data.expiry_info.expired) {
                                // User has expired, logout and show message
                                logout();
                                showNotification(data.expiry_info.message, 'error');
                            } else {
                                // Update display with new expiry info
                                checkAndDisplayExpiryInfo();
                            }
                        }
                    } catch (error) {
                        console.error('Error checking expiry:', error);
                    }
                }
            }, 5 * 60 * 1000); // 5 minutes
        }

        // Initialize autocomplete for different pages
        function initializeAutocompleteForPage(inputId, dropdownId) {
            let autocompleteTimeout;
            document.getElementById(inputId).addEventListener('input', function(e) {
                clearTimeout(autocompleteTimeout);
                const query = e.target.value;
                
                if (query.length < 2) {
                    document.getElementById(dropdownId).classList.add('hidden');
            return;
        }
        
                autocompleteTimeout = setTimeout(async () => {
                    try {
                        const response = await fetch(`/autocomplete?q=${encodeURIComponent(query)}`);
                        const suggestions = await response.json();
                        
                        const dropdown = document.getElementById(dropdownId);
                        if (suggestions.length > 0) {
            dropdown.innerHTML = suggestions.map(suggestion => {
                                // Manejar tanto strings simples como objetos
                                if (typeof suggestion === 'string') {
                                    return `<div class="p-3 hover:bg-gray-600 cursor-pointer text-white" onclick="selectPlayerForPage('${suggestion}', '${inputId}', '${dropdownId}')">
                                        ${suggestion}
                                    </div>`;
                                } else {
                                    const displayName = suggestion.name || suggestion;
                                    return `<div class="p-3 hover:bg-gray-600 cursor-pointer text-white" onclick="selectPlayerForPage('${displayName}', '${inputId}', '${dropdownId}')">
                                        <div class="font-bold">${suggestion.name}</div>
                                        <div class="text-sm text-gray-400">${suggestion.club} • ${suggestion.nationality}</div>
                                    </div>`;
                                }
                            }).join('');
        dropdown.classList.remove('hidden');
                        } else {
            dropdown.classList.add('hidden');
    }
                    } catch (error) {
                        console.error('Autocomplete error:', error);
                    }
                }, 300);
            });
        }

        // Initialize club search for different pages
        function initializeClubSearchForPage(inputId, dropdownId) {
            let clubTimeout;
            document.getElementById(inputId).addEventListener('input', function(e) {
                clearTimeout(clubTimeout);
                const query = e.target.value;
                
                if (query.length < 2) {
                    document.getElementById(dropdownId).classList.add('hidden');
                    return;
                }
                
                clubTimeout = setTimeout(async () => {
                    try {
                        const response = await fetch(`/clubs?q=${encodeURIComponent(query)}`);
                        const clubs = await response.json();
                        
                        const dropdown = document.getElementById(dropdownId);
                        if (clubs.length > 0) {
                            dropdown.innerHTML = clubs.map(club => {
                                const clubName = typeof club === 'string' ? club : club.name;
                                return `
                                    <div class="p-3 hover:bg-gray-600 cursor-pointer text-white border-b border-gray-600 last:border-b-0" onclick="selectClubForPage('${clubName}', '${inputId}', '${dropdownId}')">
                                        <div class="font-medium">${clubName}</div>
                                        ${typeof club !== 'string' ? `<div class="text-sm text-gray-400">${club.country} - ${club.market_value}</div>` : ''}
                                    </div>
                                `;
                            }).join('');
                            dropdown.classList.remove('hidden');
                        } else {
                            dropdown.classList.add('hidden');
                        }
                    } catch (error) {
                        console.error('Club search error:', error);
                    }
                }, 300);
            });
        }

        // Select player from autocomplete for different pages
        function selectPlayerForPage(playerName, inputId, dropdownId) {
            document.getElementById(inputId).value = playerName;
            document.getElementById(dropdownId).classList.add('hidden');
        }

        // Select club from dropdown for different pages
        function selectClubForPage(clubName, inputId, dropdownId) {
            document.getElementById(inputId).value = clubName;
            document.getElementById(dropdownId).classList.add('hidden');
            loadClubInfo(clubName);
        }

        // Player comparison functions
        let player1Data = null;
        let player2Data = null;

        async function searchPlayer1() {
            const playerName = document.getElementById('player1Search').value;
            const clubName = document.getElementById('club1Search').value;
            
            if (!playerName) {
                alert('Por favor ingresa el nombre del jugador');
                return;
            }

            try {
                const currentLanguage = localStorage.getItem('language') || 'es';
                const response = await fetch(`/search?name=${encodeURIComponent(playerName)}&club=${encodeURIComponent(clubName)}&language=${currentLanguage}`);
                const data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }

                player1Data = data;
                displayPlayer1(data);
                updateComparison();
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar el jugador');
            }
        }

        function displayPlayer1(data) {
            const playerInfo = data.player;
            const analysis = data.truesign_analysis;
            
            // Mostrar resultados
            document.getElementById('player1Results').classList.remove('hidden');
            
            // Información básica - USAR 'name' no 'player_name'
            const playerName = playerInfo.name || playerInfo.player_name || '--';
            const age = playerInfo.age && playerInfo.age > 0 ? playerInfo.age : '25';
            const position = formatPosition(playerInfo.position);
            
            document.getElementById('player1Name').textContent = playerName;
            document.getElementById('player1Club').textContent = playerInfo.club || '--';
            document.getElementById('player1Info').textContent = `${age} años, ${position}`;
            
            // Foto del jugador o iniciales
            const photoUrl = playerInfo.photo_url || playerInfo.player_image_url;
            const photoElement = document.getElementById('player1Photo');
            const initialsElement = document.getElementById('player1Initials');
            
            if (photoUrl && photoUrl !== '') {
                photoElement.src = photoUrl;
                photoElement.classList.remove('hidden');
                initialsElement.classList.add('hidden');
            } else {
                const initials = playerName.split(' ').map(n => n[0]).join('').substring(0, 2);
                initialsElement.textContent = initials || '--';
                photoElement.classList.add('hidden');
                initialsElement.classList.remove('hidden');
            }
            
            // Valores
            const marketValue = (playerInfo.market_value || 0) / 1000000;
            const recommendedPrice = (analysis.fair_price || 0) / 1000000;
            const roiPercentage = analysis.roi_estimate?.percentage || 0;
            
            document.getElementById('player1MarketValue').textContent = `€${marketValue.toFixed(1)}M`;
            document.getElementById('player1RecommendedPrice').textContent = `€${recommendedPrice.toFixed(1)}M`;
            
            // ROI con color según valor
            const roi1Element = document.getElementById('player1ROI');
            const roiText = roiPercentage >= 0 ? `+${roiPercentage.toFixed(1)}%` : `${roiPercentage.toFixed(1)}%`;
            roi1Element.textContent = roiText;
            roi1Element.className = roiPercentage >= 30 ? 'text-green-400 font-semibold' : 
                                    roiPercentage >= 15 ? 'text-yellow-400 font-semibold' : 
                                    roiPercentage >= 0 ? 'text-orange-400 font-semibold' : 
                                    'text-red-400 font-semibold';
            
            // Los 5 valores - USAR NOMBRES CORRECTOS
            const fiveValues = analysis.five_values || {};
            document.getElementById('player1Marketing').textContent = `€${((fiveValues.marketing_impact || fiveValues.marketing_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player1Sport').textContent = `€${((fiveValues.sporting_value || fiveValues.sport_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player1Resale').textContent = `€${((fiveValues.resale_potential || fiveValues.resale_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player1Similar').textContent = `€${((fiveValues.similar_transfers || fiveValues.similar_transfers_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player1Market').textContent = `€${((fiveValues.market_value || fiveValues.different_market_values || 0) / 1000000).toFixed(1)}M`;
            
            // Club destino
            const clubDestino1 = data.club_destino || document.getElementById('club1Search')?.value || '--';
            document.getElementById('player1ClubDestino').textContent = clubDestino1;
            
            // Análisis LLM
            const llmAnalysis1 = data.analysis_text || 'Análisis no disponible.';
            const llmElement1 = document.getElementById('player1LLMAnalysis');
            if (llmElement1) {
                llmElement1.textContent = llmAnalysis1;
                llmElement1.removeAttribute('data-i18n');
            }
            
            // Aplicar traducciones
            const savedLang = localStorage.getItem('language') || 'es';
            applyTranslations(savedLang);
        }

        async function searchPlayer2() {
            const playerName = document.getElementById('player2Search').value;
            const clubName = document.getElementById('club2Search').value;
            
            if (!playerName) {
                alert('Por favor ingresa el nombre del jugador');
                return;
            }

            try {
                const currentLanguage = localStorage.getItem('language') || 'es';
                const response = await fetch(`/search?name=${encodeURIComponent(playerName)}&club=${encodeURIComponent(clubName)}&language=${currentLanguage}`);
                const data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }

                player2Data = data;
                displayPlayer2(data);
                updateComparison();
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar el jugador');
            }
        }

        function displayPlayer2(data) {
            const playerInfo = data.player;
            const analysis = data.truesign_analysis;
            
            // Mostrar resultados
            document.getElementById('player2Results').classList.remove('hidden');
            
            // Información básica - USAR 'name' no 'player_name'
            const playerName = playerInfo.name || playerInfo.player_name || '--';
            const age = playerInfo.age && playerInfo.age > 0 ? playerInfo.age : '25';
            const position = formatPosition(playerInfo.position);
            
            document.getElementById('player2Name').textContent = playerName;
            document.getElementById('player2Club').textContent = playerInfo.club || '--';
            document.getElementById('player2Info').textContent = `${age} años, ${position}`;
            
            // Foto del jugador o iniciales
            const photoUrl = playerInfo.photo_url || playerInfo.player_image_url;
            const photoElement = document.getElementById('player2Photo');
            const initialsElement = document.getElementById('player2Initials');
            
            if (photoUrl && photoUrl !== '') {
                photoElement.src = photoUrl;
                photoElement.classList.remove('hidden');
                initialsElement.classList.add('hidden');
            } else {
                const initials = playerName.split(' ').map(n => n[0]).join('').substring(0, 2);
                initialsElement.textContent = initials || '--';
                photoElement.classList.add('hidden');
                initialsElement.classList.remove('hidden');
            }
            
            // Valores
            const marketValue = (playerInfo.market_value || 0) / 1000000;
            const recommendedPrice = (analysis.fair_price || 0) / 1000000;
            const roiPercentage = analysis.roi_estimate?.percentage || 0;
            
            document.getElementById('player2MarketValue').textContent = `€${marketValue.toFixed(1)}M`;
            document.getElementById('player2RecommendedPrice').textContent = `€${recommendedPrice.toFixed(1)}M`;
            
            // ROI con color según valor
            const roi2Element = document.getElementById('player2ROI');
            const roiText = roiPercentage >= 0 ? `+${roiPercentage.toFixed(1)}%` : `${roiPercentage.toFixed(1)}%`;
            roi2Element.textContent = roiText;
            roi2Element.className = roiPercentage >= 30 ? 'text-green-400 font-semibold' : 
                                    roiPercentage >= 15 ? 'text-yellow-400 font-semibold' : 
                                    roiPercentage >= 0 ? 'text-orange-400 font-semibold' : 
                                    'text-red-400 font-semibold';
            
            // Los 5 valores - USAR NOMBRES CORRECTOS
            const fiveValues = analysis.five_values || {};
            document.getElementById('player2Marketing').textContent = `€${((fiveValues.marketing_impact || fiveValues.marketing_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player2Sport').textContent = `€${((fiveValues.sporting_value || fiveValues.sport_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player2Resale').textContent = `€${((fiveValues.resale_potential || fiveValues.resale_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player2Similar').textContent = `€${((fiveValues.similar_transfers || fiveValues.similar_transfers_value || 0) / 1000000).toFixed(1)}M`;
            document.getElementById('player2Market').textContent = `€${((fiveValues.market_value || fiveValues.different_market_values || 0) / 1000000).toFixed(1)}M`;
            
            // Club destino
            const clubDestino2 = data.club_destino || document.getElementById('club2Search')?.value || '--';
            document.getElementById('player2ClubDestino').textContent = clubDestino2;
            
            // Análisis LLM
            const llmAnalysis2 = data.analysis_text || 'Análisis no disponible.';
            const llmElement2 = document.getElementById('player2LLMAnalysis');
            if (llmElement2) {
                llmElement2.textContent = llmAnalysis2;
                llmElement2.removeAttribute('data-i18n');
            }
            
            // Aplicar traducciones
            const savedLang = localStorage.getItem('language') || 'es';
            applyTranslations(savedLang);
        }

        function updateComparison() {
            if (player1Data && player2Data) {
                // Mostrar resumen de comparación
                document.getElementById('comparisonSummary').classList.remove('hidden');
                
                const player1Price = player1Data.truesign_analysis.fair_price || 0;
                const player2Price = player2Data.truesign_analysis.fair_price || 0;
                const difference = Math.abs(player1Price - player2Price);
                
                // USAR 'name' no 'player_name'
                const player1Name = player1Data.player.name || player1Data.player.player_name || 'Jugador 1';
                const player2Name = player2Data.player.name || player2Data.player.player_name || 'Jugador 2';
                const betterValue = player1Price < player2Price ? player1Name : player2Name;
                
                const roi1 = player1Data.truesign_analysis.roi_estimate?.percentage || 0;
                const roi2 = player2Data.truesign_analysis.roi_estimate?.percentage || 0;
                const betterROI = roi1 > roi2 ? player1Name : player2Name;
                
                document.getElementById('priceDifference').textContent = `€${(difference / 1000000).toFixed(1)}M`;
                document.getElementById('betterValue').textContent = betterValue;
                document.getElementById('roiComparison').textContent = `${betterROI} (${Math.max(roi1, roi2).toFixed(1)}%)`;
            }
        }

        // Traducciones cargadas desde translations.js externo
        /* BLOQUE DE TRADUCCIONES ELIMINADO - Se usa translations.js
        const translations = {
            es: {
                // Navegación
                'Dashboard': 'Dashboard',
                'Search Players': 'Buscar Jugadores',
                'Compare Players': 'Comparar Jugadores',
                'ROI Reports': 'Reportes ROI',
                'Settings': 'Configuración',
                
                // Campos de búsqueda
                'Search player...': 'Buscar jugador...',
                'e.g: Lionel Messi': 'Ej: Lionel Messi',
                'Search destination club...': 'Buscar club destino...',
                'Destination club...': 'Club destino...',
                'Search Player': 'Buscar Jugador',
                'Search Player 1': 'Buscar Jugador 1',
                'Search Player 2': 'Buscar Jugador 2',
                'Analyze Player': 'Analizar Jugador',
                'Player Analysis': 'Análisis de Jugador',
                'Player Name': 'Nombre del Jugador',
                'Target ROI (%)': 'ROI Objetivo (%)',
                'Destination Club': 'Club Destino',
                
                // Información del jugador
                'years old': 'años',
                'Height': 'Altura',
                'Dominant foot': 'Pie hábil',
                'Value': 'Valor',
                'Position': 'Posición',
                'Nationality': 'Nacionalidad',
                'Age': 'Edad',
                'Club': 'Club',
                'Contract': 'Contrato',
                
                // Posiciones
                'Goalkeeper': 'Portero',
                'Defender': 'Defensor',
                'Midfielder': 'Mediocampista',
                'Forward': 'Delantero',
                'Winger': 'Extremo',
                'Centre-Back': 'Defensor Central',
                'Left-Back': 'Lateral Izquierdo',
                'Right-Back': 'Lateral Derecho',
                'Defensive Midfielder': 'Mediocampista Defensivo',
                'Attacking Midfielder': 'Mediocampista Ofensivo',
                'Striker': 'Delantero Centro',
                
                // Pie
                'Right': 'Derecho',
                'Left': 'Izquierdo',
                'Both': 'Ambidiestro',
                'Right-footed': 'Diestro',
                'Left-footed': 'Zurdo',
                
                // Análisis
                'Maximum Recommended Price': 'Precio Máximo Recomendado',
                'Confidence': 'Confianza',
                'Confidence:': 'Confianza:',
                'Estimated ROI': 'ROI Estimado',
                'Destination Club': 'Club Destino',
                'Destination Club:': 'Club Destino:',
                'Intelligent Analysis': 'Análisis Inteligente',
                'Generating analysis...': 'Generando análisis...',
                'Analysis not available': 'Análisis no disponible',
                'Performance Analysis': 'Análisis de Rendimiento',
                
                // ROI Objetivo
                'ROI Objective Analysis': 'Análisis de ROI Objetivo',
                'Meets ROI objective': 'Cumple objetivo de ROI',
                'Does not meet ROI objective': 'No alcanza objetivo de ROI',
                'ML Price': 'Precio ML',
                'Maximum to pay': 'Máximo a pagar',
                'For ROI': 'Para ROI',
                
                // Cinco Valores
                'The 5 Fundamental Values': 'Los 5 Valores Fundamentales',
                'Marketing Value': 'Valor Marketing',
                'Sporting Value': 'Valor Deportivo',
                'Resale Value': 'Valor Reventa',
                'Similar Transfers': 'Transferencias Similares',
                'Market Values': 'Valores de Mercado',
                'Marketing': 'Marketing',
                'Sporting': 'Deportivo',
                'Resale': 'Reventa',
                'Similar': 'Similares',
                'Market': 'Mercado',
                
                // Opciones de ROI
                '10% - Conservative': '10% - Conservador',
                '20% - Moderate': '20% - Moderado',
                '30% - Balanced': '30% - Equilibrado',
                '40% - Aggressive': '40% - Agresivo',
                '50% - High Risk': '50% - Alto Riesgo',
                '60% - Very Aggressive': '60% - Muy Agresivo',
                '70% - Extreme': '70% - Extremo',
                '80% - Maximum': '80% - Máximo',
                
                // Predicción ML
                'Enhanced ML Prediction with Club Analysis': 'Predicción ML Mejorada con Análisis de Club',
                'Predicted Change': 'Cambio Predicho',
                'Predicted Change:': 'Cambio Predicho:',
                'Future Value': 'Valor Futuro',
                'Future Value:': 'Valor Futuro:',
                'Prediction': 'Predicción',
                
                // Comparación
                'Comparison Summary': 'Resumen de Comparación',
                'Price Difference': 'Diferencia de Precio',
                'Better Value': 'Mejor Valor',
                'Player 1': 'Jugador 1',
                'Player 2': 'Jugador 2',
                
                // Valores
                'Market Value': 'Valor de Mercado',
                'Recommended Price': 'Precio Recomendado',
                'Current Value': 'Valor Actual',
                
                // Settings
                'Language Settings': 'Configuración de Idioma',
                'Language': 'Idioma',
                'Change Language': 'Cambiar Idioma',
                'Select your preferred language for the interface': 'Selecciona tu idioma preferido para la interfaz',
                
                // Dashboard
                'TrueSign Dashboard': 'TrueSign Dashboard',
                'Welcome to TrueSign!': '¡Bienvenido a TrueSign!',
                'Recent Players': 'Jugadores Recientes',
                'How Does TrueSign Work?': '¿Cómo Funciona TrueSign?',
                
                // Mensajes
                'Language changed successfully': 'Idioma cambiado exitosamente',
                'Error': 'Error',
                'Success': 'Éxito',
                'Loading...': 'Cargando...',
                'Please wait...': 'Por favor espera...',
                'Search': 'Buscar',
                'Analyze': 'Analizar',
                'Compare': 'Comparar',
                'Generate Report': 'Generar Reporte',
                'Generating...': 'Generando...',
                'Generando...': 'Generando...',
                'Generating Report...': 'Generando Reporte...',
                'Generando Reporte...': 'Generando Reporte...',
                'Analyzing player data with AI...': 'Analizando datos del jugador con IA...',
                'Analizando datos del jugador con IA...': 'Analizando datos del jugador con IA...',
                
                // Traducciones adicionales para todas las secciones
                'Player Analysis': 'Análisis de Jugador',
                'Player Name': 'Nombre del Jugador',
                'Target ROI (%)': 'ROI Objetivo (%)',
                'Analyze Player': 'Analizar Jugador',
                'Market Value:': 'Valor de Mercado:',
                'Recommended Price:': 'Precio Recomendado:',
                'Estimated ROI:': 'ROI Estimado:',
                
                // Compare Players
                'Search player...': 'Buscar jugador...',
                
                // Reports
                'Generate Player Report': 'Generar Reporte de Jugador',
                'Search player for report...': 'Buscar jugador para reporte...',
                'Player Summary': 'Resumen del Jugador',
                'Financial Analysis': 'Análisis Financiero',
                'ROI Projections': 'Proyecciones de ROI',
                'Market Analysis': 'Análisis de Mercado',
                'Performance Metrics': 'Métricas de Rendimiento',
                'Confidence Level:': 'Nivel de Confianza:',
                'Future Value:': 'Valor Futuro:',
                'Value Trend:': 'Tendencia de Valor:',
                'Market Position:': 'Posición en Mercado:',
                'Report Date:': 'Fecha del Reporte:',
                'Age Factor': 'Factor de Edad',
                'Position Factor': 'Factor de Posición',
                'Market Factor': 'Factor de Mercado',
                
                // Settings
                'Language Settings': 'Configuración de Idioma',
                'Settings': 'Configuración',
                'Configuración': 'Configuración',
                'Language:': 'Idioma:',
                'Idioma:': 'Idioma:',
                'Spanish': 'Español',
                'English': 'Inglés',
                'Español': 'Español',
                'Select your preferred language for the interface': 'Selecciona tu idioma preferido para la interfaz',
                'System Settings': 'Configuración del Sistema',
                'Configuración del Sistema': 'Configuración del Sistema',
                'Display Preferences': 'Preferencias de Visualización',
                'Preferencias de Visualización': 'Preferencias de Visualización',
                'Data Configuration': 'Configuración de Datos',
                'Configuración de Datos': 'Configuración de Datos',
                'Show values in millions': 'Mostrar valores en millones',
                'Mostrar valores en millones': 'Mostrar valores en millones',
                'Show detailed analysis': 'Mostrar análisis detallado',
                'Mostrar análisis detallado': 'Mostrar análisis detallado',
                'Automatic update:': 'Actualización automática:',
                'Actualización automática:': 'Actualización automática:',
                'Hourly': 'Cada hora',
                'Cada hora': 'Cada hora',
                'Daily': 'Diariamente',
                'Diariamente': 'Diariamente',
                'Weekly': 'Semanalmente',
                'Semanalmente': 'Semanalmente',
                'Analysis precision:': 'Precisión de análisis:',
                'Precisión de análisis:': 'Precisión de análisis:',
                'High (recommended)': 'Alta (recomendado)',
                'Alta (recomendado)': 'Alta (recomendado)',
                'Medium': 'Media',
                'Media': 'Media',
                'Low': 'Baja',
                'Baja': 'Baja',
                'Fast': 'Rápida',
                'Rápida': 'Rápida',
                'Position Factor': 'Factor de Posición',
                'Factor de Posición': 'Factor de Posición',
                'League Factor': 'Factor de Liga',
                'Factor de Liga': 'Factor de Liga',
                'Change Language': 'Cambiar Idioma',
                'Cambiar Idioma': 'Cambiar Idioma',
                'Price Difference': 'Diferencia de Precio',
                'Diferencia de Precio': 'Diferencia de Precio',
                'Better Value': 'Mejor Valor',
                'Mejor Valor': 'Mejor Valor',
                'Comparison Summary': 'Resumen de Comparación',
                'Resumen de Comparación': 'Resumen de Comparación',
                'Player 1': 'Jugador 1',
                'Jugador 1': 'Jugador 1',
                'Player 2': 'Jugador 2',
                'Jugador 2': 'Jugador 2',
                'Search Player 1': 'Buscar Jugador 1',
                'Buscar Jugador 1': 'Buscar Jugador 1',
                'Search Player 2': 'Buscar Jugador 2',
                'Buscar Jugador 2': 'Buscar Jugador 2',
                'Destination club...': 'Club destino...',
                'Club destino...': 'Club destino...',
                'Destination Club:': 'Club Destino:',
                'Club Destino:': 'Club Destino:',
                'Intelligent Analysis': 'Análisis Inteligente',
                'Análisis Inteligente': 'Análisis Inteligente',
                'Generating analysis...': 'Generando análisis...',
                'Generando análisis...': 'Generando análisis...',
                'The 5 Fundamental Values': 'Los 5 Valores Fundamentales',
                'Los 5 Valores Fundamentales': 'Los 5 Valores Fundamentales',
                'Sporting': 'Deportivo',
                'Deportivo': 'Deportivo',
                'Resale': 'Reventa',
                'Reventa': 'Reventa',
                'Similar': 'Similares',
                'Similares': 'Similares',
                'Market': 'Mercado',
                'Mercado': 'Mercado',
                'ROI Reports': 'Reportes ROI',
                'Reportes ROI': 'Reportes ROI',
                'Compare Players': 'Comparar Jugadores',
                'Comparar Jugadores': 'Comparar Jugadores',
                
                // Tendencias de valor
                'Strong Growth': 'Crecimiento fuerte',
                'Crecimiento fuerte': 'Crecimiento fuerte',
                'Growth': 'Crecimiento',
                'Crecimiento': 'Crecimiento',
                'Stable': 'Estable',
                'Estable': 'Estable',
                'Decline': 'Decrecimiento',
                'Decrecimiento': 'Decrecimiento',
                'Strong Decline': 'Decrecimiento fuerte',
                'Decrecimiento fuerte': 'Decrecimiento fuerte',
                
                // Posiciones de mercado
                'Elite': 'Elite',
                'High': 'Alto',
                'Alto': 'Alto',
                'Medium-High': 'Medio-Alto',
                'Medio-Alto': 'Medio-Alto',
                'Medium': 'Medio',
                'Medio': 'Medio',
                'Emerging': 'Emergente',
                'Emergente': 'Emergente',
                
                // Niveles de factores
                'Excellent': 'Excelente',
                'Excelente': 'Excelente',
                'Very Good': 'Muy Bueno',
                'Muy Bueno': 'Muy Bueno',
                'Good': 'Bueno',
                'Bueno': 'Bueno',
                'Fair': 'Regular',
                'Regular': 'Regular',
                'Low': 'Bajo',
                'Bajo': 'Bajo',
                
                // PDF Download
                'Download PDF': 'Descargar PDF',
                'Descargar PDF': 'Descargar PDF',
                'Player Report': 'Reporte de Jugador',
                'Reporte de Jugador': 'Reporte de Jugador',
                
                // Posiciones de jugadores
                'Goalkeeper': 'Portero',
                'Portero': 'Portero',
                'Defender': 'Defensor',
                'Defensor': 'Defensor',
                'Midfielder': 'Mediocampista',
                'Mediocampista': 'Mediocampista',
                'Winger': 'Extremo',
                'Extremo': 'Extremo',
                'Forward': 'Delantero',
                'Delantero': 'Delantero',
                'Attacking Midfield': 'Mediocampista Ofensivo',
                'Mediocampista Ofensivo': 'Mediocampista Ofensivo',
                'Defensive Midfield': 'Mediocampista Defensivo',
                'Mediocampista Defensivo': 'Mediocampista Defensivo',
                'Centre-Back': 'Defensor Central',
                'Defensor Central': 'Defensor Central',
                'Left-Back': 'Lateral Izquierdo',
                'Lateral Izquierdo': 'Lateral Izquierdo',
                'Right-Back': 'Lateral Derecho',
                'Lateral Derecho': 'Lateral Derecho',
                
                'The 5 Fundamental Values Breakdown': 'Desglose de los 5 Valores Fundamentales',
                'Desglose de los 5 Valores Fundamentales': 'Desglose de los 5 Valores Fundamentales',
                'Marketing Value': 'Valor de Marketing',
                'Valor de Marketing': 'Valor de Marketing',
                'Sporting Value': 'Valor Deportivo',
                'Valor Deportivo': 'Valor Deportivo',
                'Resale Value': 'Valor de Reventa',
                'Valor de Reventa': 'Valor de Reventa',
                'Similar Transfers': 'Transferencias Similares',
                'Transferencias Similares': 'Transferencias Similares',
                'Market Value': 'Valor de Mercado',
                'Valor de Mercado': 'Valor de Mercado',
                
                // Account Settings
                'Account Settings': 'Configuración de Cuenta',
                'Configuración de Cuenta': 'Configuración de Cuenta',
                'Personal Information': 'Información Personal',
                'Información Personal': 'Información Personal',
                'Username:': 'Nombre de usuario:',
                'Nombre de usuario:': 'Nombre de usuario:',
                'Email:': 'Email:',
                'Role:': 'Rol:',
                'Rol:': 'Rol:',
                'Security': 'Seguridad',
                'Seguridad': 'Seguridad',
                'Change Password': 'Cambiar Contraseña',
                'Cambiar Contraseña': 'Cambiar Contraseña',
                'Logout': 'Cerrar Sesión',
                'Cerrar Sesión': 'Cerrar Sesión',
                'Control Panel': 'Panel de control',
                'Panel de control': 'Panel de control',
                'User': 'Usuario',
                'Usuario': 'Usuario',
                
                // Opciones de ROI más descriptivas
                'Conservative': 'Conservador',
                'Moderate': 'Moderado',
                'Balanced': 'Equilibrado',
                'Aggressive': 'Agresivo',
                'High Risk': 'Alto Riesgo',
                'Very Aggressive': 'Muy Agresivo',
                'Extreme': 'Extremo',
                'Maximum': 'Máximo'
            },
            en: {} // El inglés es la inversa de español
        };
        FIN DEL BLOQUE ELIMINADO */
        
        // Crear traducciones inversas para inglés (TAMBIÉN ELIMINADO - se hace en translations.js)
        /*
        Object.keys(translations.es).forEach(esText => {
            const enText = translations.es[esText];
            translations.en[enText] = esText;
        });
        */
        
        function changeLanguage(showAlert = true) {
            const languageSelect = document.getElementById('languageSelect');
            const selectedLanguage = languageSelect.value;
            
            // Usar función del archivo externo translations.js
            if (typeof applyTranslations === 'function') {
                applyTranslations(selectedLanguage);
                
                // Mostrar mensaje
                if (showAlert) {
                    const message = selectedLanguage === 'en' ? '✅ Language changed successfully' : '✅ Idioma cambiado exitosamente';
                    showSuccessMessage(message);
                }
            }
        }

        /* FUNCIONES changeToEnglish y changeToSpanish ELIMINADAS - Se usa applyTranslations
        function changeToEnglish() {
            // Navigation
            document.querySelector('a[onclick="showPage(\'dashboard\')"]').innerHTML = '<i class="fas fa-tachometer-alt mr-3"></i> Dashboard';
            document.querySelector('a[onclick="showPage(\'search\')"]').innerHTML = '<i class="fas fa-search mr-3"></i> Search Players';
            document.querySelector('a[onclick="showPage(\'compare\')"]').innerHTML = '<i class="fas fa-exchange-alt mr-3"></i> Compare Players';
            document.querySelector('a[onclick="showPage(\'reports\')"]').innerHTML = '<i class="fas fa-chart-line mr-3"></i> ROI Reports';
            document.querySelector('a[onclick="showPage(\'settings\')"]').innerHTML = '<i class="fas fa-cog mr-3"></i> Settings';
            
            // Page titles
            document.querySelector('#dashboard h1').textContent = 'TrueSign Dashboard';
            document.querySelector('#search h1').textContent = 'Search Players';
            document.querySelector('#compare h1').textContent = 'Compare Players';
            document.querySelector('#reports h1').textContent = 'ROI Reports';
            document.querySelector('#settings h1').textContent = 'Settings';
            
            // Dashboard page
            const dashboardWelcome = document.querySelector('#dashboard h2');
            if (dashboardWelcome) dashboardWelcome.textContent = 'Welcome to TrueSign!';
            
            const dashboardSubtitle = document.querySelector('#dashboard .text-green-100');
            if (dashboardSubtitle) dashboardSubtitle.textContent = 'Your world\'s most advanced transfer analysis system';
            
            // Dashboard stats
            const dashboardStats = document.querySelectorAll('#dashboard .text-gray-400');
            dashboardStats.forEach((stat, index) => {
                switch(index) {
                    case 0: stat.textContent = 'Players Analyzed'; break;
                    case 1: stat.textContent = 'Transfers Analyzed'; break;
                    case 2: stat.textContent = 'Model Accuracy'; break;
                    case 3: stat.textContent = 'Completed Analysis'; break;
                }
            });
            
            // Dashboard section titles
            const dashboardSectionTitles = document.querySelectorAll('#dashboard h2');
            dashboardSectionTitles.forEach((title, index) => {
                if (title.textContent.includes('¿Cómo Funciona TrueSign?')) {
                    title.textContent = 'How Does TrueSign Work?';
                } else if (title.textContent.includes('Jugadores Recientes')) {
                    title.textContent = 'Recent Players';
                }
            });
            
            // Model explanation section
            const modelSteps = document.querySelectorAll('#dashboard h3');
            modelSteps.forEach((step, index) => {
                if (step.textContent.includes('Análisis de Datos')) {
                    step.textContent = 'Data Analysis';
                } else if (step.textContent.includes('Los 5 Valores Fundamentales')) {
                    step.textContent = 'The 5 Fundamental Values';
                } else if (step.textContent.includes('IA Predictiva')) {
                    step.textContent = 'Predictive AI';
                } else if (step.textContent.includes('Metodología Científica')) {
                    step.textContent = 'Scientific Methodology';
                }
            });
            
            // Model explanation content
            const modelContent = document.querySelectorAll('#dashboard p');
            modelContent.forEach((p, index) => {
                if (p.textContent.includes('Analizamos más de')) {
                    p.textContent = 'We analyze more than 92,000 real professional player transfers, including market data, sporting performance and club context.';
                } else if (p.textContent.includes('Calculamos el valor basado en')) {
                    p.textContent = 'We calculate value based on 5 key components: Marketing, Sporting, Resale, Similar Transfers and Market Values.';
                } else if (p.textContent.includes('Utilizamos inteligencia artificial')) {
                    p.textContent = 'We use advanced artificial intelligence to predict optimal price and expected ROI with 95% accuracy.';
                }
            });
            
            // Model methodology headers
            const methodologyHeaders = document.querySelectorAll('#dashboard h4');
            methodologyHeaders.forEach((header, index) => {
                if (header.textContent.includes('Datos Analizados')) {
                    header.textContent = '📊 Data Analyzed';
                } else if (header.textContent.includes('Precisión del Modelo')) {
                    header.textContent = '🎯 Model Accuracy';
                } else if (header.textContent.includes('¿Por qué TrueSign es único?')) {
                    header.textContent = 'Why is TrueSign unique?';
                }
            });
            
            // Dashboard section descriptions
            const dashboardSectionDescriptions = document.querySelectorAll('#dashboard p');
            dashboardSectionDescriptions.forEach((desc, index) => {
                if (desc.textContent.includes('Busca jugadores para verlos aquí')) {
                    desc.textContent = 'Search players to see them here';
                }
            });
            
            // Dashboard sections
            const dashboardSections = document.querySelectorAll('#dashboard h3');
            dashboardSections.forEach((section, index) => {
                switch(index) {
                    case 0: section.textContent = 'Quick Analysis'; break;
                    case 1: section.textContent = 'Recent Statistics'; break;
                    case 2: section.textContent = 'Top Players'; break;
                }
            });
            
            // Dashboard descriptions
            const dashboardDescriptions = document.querySelectorAll('#dashboard .text-gray-400');
            dashboardDescriptions.forEach((desc, index) => {
                if (desc.textContent.includes('Busca cualquier jugador')) {
                    desc.textContent = 'Search any player';
                } else if (desc.textContent.includes('Últimos análisis realizados')) {
                    desc.textContent = 'Latest analysis performed';
                } else if (desc.textContent.includes('Jugadores con mayor valor')) {
                    desc.textContent = 'Players with highest value';
                }
            });
            
            // Dashboard buttons
            const dashboardButtons = document.querySelectorAll('#dashboard button');
            dashboardButtons.forEach(button => {
                if (button.textContent.includes('Buscar')) {
                    button.textContent = 'Search';
                }
            });
            
            // Search page
            document.querySelector('#playerSearch2').placeholder = 'Search player...';
            document.querySelector('#clubSearch2').placeholder = 'Destination club...';
            document.querySelector('button[onclick="searchPlayerFromPage(\'search\')"]').textContent = 'Search Player';
            
            // Compare page
            document.querySelectorAll('#player1Search, #player2Search').forEach(input => {
                input.placeholder = 'Search player...';
            });
            document.querySelectorAll('#club1Search, #club2Search').forEach(input => {
                input.placeholder = 'Destination club...';
            });
            document.querySelector('button[onclick="searchPlayer1()"]').textContent = 'Search Player 1';
            document.querySelector('button[onclick="searchPlayer2()"]').textContent = 'Search Player 2';
            
            // Compare page labels
            const compareLabels = document.querySelectorAll('#compare h2');
            if (compareLabels[0]) compareLabels[0].textContent = 'Player 1';
            if (compareLabels[1]) compareLabels[1].textContent = 'Player 2';
            
            // Compare page summary
            const summaryElements = document.querySelectorAll('#comparisonSummary h3');
            if (summaryElements[0]) summaryElements[0].textContent = 'Price Difference';
            if (summaryElements[1]) summaryElements[1].textContent = 'Better Value';
            if (summaryElements[2]) summaryElements[2].textContent = 'Estimated ROI';
            
            // Reports page
            document.querySelector('#reports h2').textContent = 'Detailed Historical Analysis';
            const reportsText = document.querySelector('#reports .text-gray-400');
            if (reportsText) reportsText.textContent = 'Search a player to see detailed analysis of how the price was determined';
            
            // Settings page
            document.querySelector('#settings h2').textContent = 'Language Settings';
            document.querySelector('button[onclick="changeLanguage()"]').textContent = 'Change Language';
            
            // Settings sections
            const settingsSections = document.querySelectorAll('#settings h2');
            if (settingsSections[1]) settingsSections[1].textContent = 'System Settings';
            if (settingsSections[2]) settingsSections[2].textContent = 'Account Settings';
            
            // Settings subsections
            const settingsSubsections = document.querySelectorAll('#settings h3');
            settingsSubsections.forEach((h3, index) => {
                switch(index) {
                    case 0: h3.textContent = 'Display Preferences'; break;
                    case 1: h3.textContent = 'Data Configuration'; break;
                    case 2: h3.textContent = 'Personal Information'; break;
                    case 3: h3.textContent = 'Security'; break;
                }
            });
            
            // Settings labels and options
            const settingsLabels = document.querySelectorAll('#settings .text-gray-300');
            settingsLabels.forEach((label, index) => {
                switch(index) {
                    case 0: label.textContent = 'Show values in millions'; break;
                    case 1: label.textContent = 'Show detailed analysis'; break;
                    case 2: label.textContent = 'Dark mode (always active)'; break;
                    case 3: label.textContent = 'Automatic update:'; break;
                    case 4: label.textContent = 'Analysis precision:'; break;
                    case 5: label.textContent = 'Username:'; break;
                    case 6: label.textContent = 'Email:'; break;
                }
            });
            
            // Settings buttons
            const settingsButtons = document.querySelectorAll('#settings button');
            settingsButtons.forEach((button, index) => {
                if (button.textContent.includes('Cambiar Contraseña')) {
                    button.textContent = 'Change Password';
                } else if (button.textContent.includes('Cerrar Sesión')) {
                    button.textContent = 'Log Out';
                }
            });
            
            // Settings select options
            const selectOptions = document.querySelectorAll('#settings select option');
            selectOptions.forEach((option, index) => {
                switch(option.textContent) {
                    case 'Cada hora': option.textContent = 'Every hour'; break;
                    case 'Diariamente': option.textContent = 'Daily'; break;
                    case 'Semanalmente': option.textContent = 'Weekly'; break;
                    case 'Alta (recomendado)': option.textContent = 'High (recommended)'; break;
                    case 'Media': option.textContent = 'Medium'; break;
                    case 'Rápida': option.textContent = 'Fast'; break;
                }
            });
            
            // Settings descriptions
            const settingsDescriptions = document.querySelectorAll('#settings .text-gray-400');
            settingsDescriptions.forEach((desc, index) => {
                switch(index) {
                    case 0: desc.textContent = 'Select your preferred language for the interface'; break;
                    case 1: desc.textContent = 'Panel de control'; break; // Keep username as is
                }
            });
        }

        function changeToSpanish() {
            // Navigation
            document.querySelector('a[onclick="showPage(\'dashboard\')"]').innerHTML = '<i class="fas fa-tachometer-alt mr-3"></i> Dashboard';
            document.querySelector('a[onclick="showPage(\'search\')"]').innerHTML = '<i class="fas fa-search mr-3"></i> Buscar Jugadores';
            document.querySelector('a[onclick="showPage(\'compare\')"]').innerHTML = '<i class="fas fa-exchange-alt mr-3"></i> Comparar Jugadores';
            document.querySelector('a[onclick="showPage(\'reports\')"]').innerHTML = '<i class="fas fa-chart-line mr-3"></i> Reportes ROI';
            document.querySelector('a[onclick="showPage(\'settings\')"]').innerHTML = '<i class="fas fa-cog mr-3"></i> Configuración';
            
            // Page titles
            document.querySelector('#dashboard h1').textContent = 'Dashboard TrueSign';
            document.querySelector('#search h1').textContent = 'Buscar Jugadores';
            document.querySelector('#compare h1').textContent = 'Comparar Jugadores';
            document.querySelector('#reports h1').textContent = 'Reportes ROI';
            document.querySelector('#settings h1').textContent = 'Configuración';
            
            // Dashboard page
            const dashboardWelcome = document.querySelector('#dashboard h2');
            if (dashboardWelcome) dashboardWelcome.textContent = '¡Bienvenido a TrueSign!';
            
            const dashboardSubtitle = document.querySelector('#dashboard .text-green-100');
            if (dashboardSubtitle) dashboardSubtitle.textContent = 'Tu sistema de análisis de transferencias más avanzado del mundo';
            
            // Dashboard stats
            const dashboardStats = document.querySelectorAll('#dashboard .text-gray-400');
            dashboardStats.forEach((stat, index) => {
                switch(index) {
                    case 0: stat.textContent = 'Jugadores Analizados'; break;
                    case 1: stat.textContent = 'Transferencias Analizadas'; break;
                    case 2: stat.textContent = 'Clubes Disponibles'; break;
                    case 3: stat.textContent = 'Análisis Completados'; break;
                }
            });
            
            // Dashboard sections
            const dashboardSections = document.querySelectorAll('#dashboard h3');
            dashboardSections.forEach((section, index) => {
                switch(index) {
                    case 0: section.textContent = 'Análisis Rápido'; break;
                    case 1: section.textContent = 'Estadísticas Recientes'; break;
                    case 2: section.textContent = 'Top Jugadores'; break;
                }
            });
            
            // Dashboard descriptions
            const dashboardDescriptions = document.querySelectorAll('#dashboard .text-gray-400');
            dashboardDescriptions.forEach((desc, index) => {
                if (desc.textContent.includes('Search any player')) {
                    desc.textContent = 'Busca cualquier jugador';
                } else if (desc.textContent.includes('Latest analysis')) {
                    desc.textContent = 'Últimos análisis realizados';
                } else if (desc.textContent.includes('Players with highest')) {
                    desc.textContent = 'Jugadores con mayor valor';
                }
            });
            
            // Dashboard buttons
            const dashboardButtons = document.querySelectorAll('#dashboard button');
            dashboardButtons.forEach(button => {
                if (button.textContent.includes('Search')) {
                    button.textContent = 'Buscar';
                }
            });
            
            // Search page
            document.querySelector('#playerSearch2').placeholder = 'Buscar jugador...';
            document.querySelector('#clubSearch2').placeholder = 'Club destino...';
            document.querySelector('button[onclick="searchPlayerFromPage(\'search\')"]').textContent = 'Buscar Jugador';
            
            // Compare page
            document.querySelectorAll('#player1Search, #player2Search').forEach(input => {
                input.placeholder = 'Buscar jugador...';
            });
            document.querySelectorAll('#club1Search, #club2Search').forEach(input => {
                input.placeholder = 'Club destino...';
            });
            document.querySelector('button[onclick="searchPlayer1()"]').textContent = 'Buscar Jugador 1';
            document.querySelector('button[onclick="searchPlayer2()"]').textContent = 'Buscar Jugador 2';
            
            // Compare page labels
            const compareLabels = document.querySelectorAll('#compare h2');
            if (compareLabels[0]) compareLabels[0].textContent = 'Jugador 1';
            if (compareLabels[1]) compareLabels[1].textContent = 'Jugador 2';
            
            // Compare page summary
            const summaryElements = document.querySelectorAll('#comparisonSummary h3');
            if (summaryElements[0]) summaryElements[0].textContent = 'Diferencia de Precio';
            if (summaryElements[1]) summaryElements[1].textContent = 'Mejor Valor';
            if (summaryElements[2]) summaryElements[2].textContent = 'ROI Estimado';
            
            // Reports page
            document.querySelector('#reports h2').textContent = 'Análisis Histórico Detallado';
            const reportsText = document.querySelector('#reports .text-gray-400');
            if (reportsText) reportsText.textContent = 'Busca un jugador para ver el análisis detallado de cómo se llegó al precio';
            
            // Settings page
            document.querySelector('#settings h2').textContent = 'Configuración de Idioma';
            document.querySelector('button[onclick="changeLanguage()"]').textContent = 'Cambiar Idioma';
            
            // Settings sections
            const settingsSections = document.querySelectorAll('#settings h2');
            if (settingsSections[1]) settingsSections[1].textContent = 'Configuración del Sistema';
            if (settingsSections[2]) settingsSections[2].textContent = 'Configuración de Cuenta';
            
            // Settings subsections
            const settingsSubsections = document.querySelectorAll('#settings h3');
            settingsSubsections.forEach((h3, index) => {
                switch(index) {
                    case 0: h3.textContent = 'Preferencias de Visualización'; break;
                    case 1: h3.textContent = 'Configuración de Datos'; break;
                    case 2: h3.textContent = 'Información Personal'; break;
                    case 3: h3.textContent = 'Seguridad'; break;
                }
            });
            
            // Settings labels and options
            const settingsLabels = document.querySelectorAll('#settings .text-gray-300');
            settingsLabels.forEach((label, index) => {
                switch(index) {
                    case 0: label.textContent = 'Mostrar valores en millones'; break;
                    case 1: label.textContent = 'Mostrar análisis detallado'; break;
                    case 3: label.textContent = 'Actualización automática:'; break;
                    case 4: label.textContent = 'Precisión de análisis:'; break;
                    case 5: label.textContent = 'Nombre de usuario:'; break;
                    case 6: label.textContent = 'Email:'; break;
                }
            });
            
            // Settings buttons
            const settingsButtons = document.querySelectorAll('#settings button');
            settingsButtons.forEach((button, index) => {
                if (button.textContent.includes('Change Password')) {
                    button.textContent = 'Cambiar Contraseña';
                } else if (button.textContent.includes('Log Out')) {
                    button.textContent = 'Cerrar Sesión';
                }
            });
            
            // Settings select options
            const selectOptions = document.querySelectorAll('#settings select option');
            selectOptions.forEach((option, index) => {
                switch(option.textContent) {
                    case 'Every hour': option.textContent = 'Cada hora'; break;
                    case 'Daily': option.textContent = 'Diariamente'; break;
                    case 'Weekly': option.textContent = 'Semanalmente'; break;
                    case 'High (recommended)': option.textContent = 'Alta (recomendado)'; break;
                    case 'Medium': option.textContent = 'Media'; break;
                    case 'Fast': option.textContent = 'Rápida'; break;
                }
            });
            
            // Settings descriptions
            const settingsDescriptions = document.querySelectorAll('#settings .text-gray-400');
            settingsDescriptions.forEach((desc, index) => {
                switch(index) {
                    case 0: desc.textContent = 'Selecciona tu idioma preferido para la interfaz'; break;
                    case 1: desc.textContent = 'Panel de control'; break; // Keep username as is
                }
            });
        }
        FIN DE FUNCIONES ELIMINADAS */

        // Initialize autocomplete for compare page
        function initializeComparePage() {
            if (document.getElementById('player1Search')) {
                initializeAutocompleteForPage('player1Search', 'player1Dropdown');
                initializeClubSearchForPage('club1Search', 'club1Dropdown');
            }
            if (document.getElementById('player2Search')) {
                initializeAutocompleteForPage('player2Search', 'player2Dropdown');
                initializeClubSearchForPage('club2Search', 'club2Dropdown');
            }
        }

        // Translation helper functions
        function getCurrentLanguage() {
            return localStorage.getItem('language') || 'es';
        }

        function translateDynamicTexts() {
            const currentLang = getCurrentLanguage();
            // Usar función del archivo externo
            if (typeof applyTranslations === 'function') {
                applyTranslations(currentLang);
            }
        }

        /* FUNCIONES DE TRADUCCIÓN LEGACY ELIMINADAS - Se usa applyTranslations de translations.js
        function translateDynamicTextsOLD() {
            const currentLang = getCurrentLanguage();
            
            if (currentLang === 'en') {
                // Translate all text elements that contain Spanish text
                const allElements = document.querySelectorAll('*');
                allElements.forEach(element => {
                    if (element.children.length === 0) { // Only leaf nodes
                        const text = element.textContent;
                        
                        // Market Value
                        if (text.includes('Valor de Mercado')) {
                            element.textContent = text.replace('Valor de Mercado', 'Market Value');
                        }
                        
                        // Recommended Price
                        if (text.includes('Precio Recomendado')) {
                            element.textContent = text.replace('Precio Recomendado', 'Recommended Price');
                        }
                        
                        // Maximum Recommended Price
                        if (text.includes('Precio Máximo Recomendado')) {
                            element.textContent = text.replace('Precio Máximo Recomendado', 'Maximum Recommended Price');
                        }
                        
                        // Five Fundamental Values
                        if (text.includes('Los 5 Valores Fundamentales')) {
                            element.textContent = text.replace('Los 5 Valores Fundamentales', 'The 5 Fundamental Values');
                        }
                        
                        // Confidence
                        if (text.includes('Confianza')) {
                            element.textContent = text.replace('Confianza', 'Confidence');
                        }
                        
                        // Estimated ROI
                        if (text.includes('ROI Estimado')) {
                            element.textContent = text.replace('ROI Estimado', 'Estimated ROI');
                        }
                        
                        // Marketing Value
                        if (text.includes('Valor Marketing')) {
                            element.textContent = text.replace('Valor Marketing', 'Marketing Value');
                        }
                        
                        // Sporting Value
                        if (text.includes('Valor Deportivo')) {
                            element.textContent = text.replace('Valor Deportivo', 'Sporting Value');
                        }
                        
                        // Resale Value
                        if (text.includes('Valor Reventa')) {
                            element.textContent = text.replace('Valor Reventa', 'Resale Value');
                        }
                        
                        // Similar Transfers
                        if (text.includes('Transferencias Similares')) {
                            element.textContent = text.replace('Transferencias Similares', 'Similar Transfers');
                        }
                        
                        // Market Values
                        if (text.includes('Valores de Mercado')) {
                            element.textContent = text.replace('Valores de Mercado', 'Market Values');
                        }
                        
                        // Age
                        if (text.includes('años')) {
                            element.textContent = text.replace('años', 'years old');
                        }
                        
                        // Height
                        if (text.includes('Altura:')) {
                            element.textContent = text.replace('Altura:', 'Height:');
                        }
                        
                        // Dominant foot
                        if (text.includes('Pie hábil:')) {
                            element.textContent = text.replace('Pie hábil:', 'Dominant foot:');
                        }
                        
                        // Right-footed
                        if (text.includes('Diestro')) {
                            element.textContent = text.replace('Diestro', 'Right-footed');
                        }
                        
                        // Left-footed
                        if (text.includes('Zurdo')) {
                            element.textContent = text.replace('Zurdo', 'Left-footed');
                        }
                        
                        // Ambidextrous
                        if (text.includes('Ambidiestro')) {
                            element.textContent = text.replace('Ambidiestro', 'Ambidextrous');
                        }
                    }
                });
            } else {
                // Translate back to Spanish
                const allElements = document.querySelectorAll('*');
                allElements.forEach(element => {
                    if (element.children.length === 0) { // Only leaf nodes
                        const text = element.textContent;
                        
                        // Market Value
                        if (text.includes('Market Value')) {
                            element.textContent = text.replace('Market Value', 'Valor de Mercado');
                        }
                        
                        // Recommended Price
                        if (text.includes('Recommended Price')) {
                            element.textContent = text.replace('Recommended Price', 'Precio Recomendado');
                        }
                        
                        // Maximum Recommended Price
                        if (text.includes('Maximum Recommended Price')) {
                            element.textContent = text.replace('Maximum Recommended Price', 'Precio Máximo Recomendado');
                        }
                        
                        // Five Fundamental Values
                        if (text.includes('The 5 Fundamental Values')) {
                            element.textContent = text.replace('The 5 Fundamental Values', 'Los 5 Valores Fundamentales');
                        }
                        
                        // Confidence
                        if (text.includes('Confidence')) {
                            element.textContent = text.replace('Confidence', 'Confianza');
                        }
                        
                        // Estimated ROI
                        if (text.includes('Estimated ROI')) {
                            element.textContent = text.replace('Estimated ROI', 'ROI Estimado');
                        }
                        
                        // Marketing Value
                        if (text.includes('Marketing Value')) {
                            element.textContent = text.replace('Marketing Value', 'Valor Marketing');
                        }
                        
                        // Sporting Value
                        if (text.includes('Sporting Value')) {
                            element.textContent = text.replace('Sporting Value', 'Valor Deportivo');
                        }
                        
                        // Resale Value
                        if (text.includes('Resale Value')) {
                            element.textContent = text.replace('Resale Value', 'Valor Reventa');
                        }
                        
                        // Similar Transfers
                        if (text.includes('Similar Transfers')) {
                            element.textContent = text.replace('Similar Transfers', 'Transferencias Similares');
                        }
                        
                        // Market Values
                        if (text.includes('Market Values')) {
                            element.textContent = text.replace('Market Values', 'Valores de Mercado');
                        }
                        
                        // Age
                        if (text.includes('years old')) {
                            element.textContent = text.replace('years old', 'años');
                        }
                        
                        // Height
                        if (text.includes('Height:')) {
                            element.textContent = text.replace('Height:', 'Altura:');
                        }
                        
                        // Dominant foot
                        if (text.includes('Dominant foot:')) {
                            element.textContent = text.replace('Dominant foot:', 'Pie hábil:');
                        }
                        
                        // Right-footed
                        if (text.includes('Right-footed')) {
                            element.textContent = text.replace('Right-footed', 'Diestro');
                        }
                        
                        // Left-footed
                        if (text.includes('Left-footed')) {
                            element.textContent = text.replace('Left-footed', 'Zurdo');
                        }
                        
                        // Ambidextrous
                        if (text.includes('Ambidextrous')) {
                            element.textContent = text.replace('Ambidextrous', 'Ambidiestro');
                        }
                    }
                });
            }
        }
        FIN DE TRADUCCIÓN LEGACY */

        // Enhanced search functions with translation
        async function searchPlayerFromPageWithTranslation(pageId) {
            await searchPlayerFromPage(pageId);
            translateDynamicTexts();
        }

        async function searchPlayer1WithTranslation() {
            await searchPlayer1();
            translateDynamicTexts();
        }

        async function searchPlayer2WithTranslation() {
            await searchPlayer2();
            translateDynamicTexts();
        }

        // Funciones del sistema de estado
        async function checkSystemStatus() {
            try {
                const response = await fetch('/system/status');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const status = await response.json();
                console.log('System Status:', status);
                return status;
            } catch (error) {
                console.error('Error fetching system status:', error);
                return { models: { hybrid_model: { available: false } } };
            }
        }

        async function testSystemModel() {
            try {
                const response = await fetch('/system/test-model');
                const result = await response.json();
                if (response.ok) {
                    alert(`Test de Modelo Híbrido Exitoso:\nPrecio Máximo: €${formatValue(result.test_result.maximum_price)}M\nROI: ${result.test_result.roi_percentage.toFixed(2)}%\nConfianza: ${result.test_result.confidence}%`);
                } else {
                    alert(`Error en Test de Modelo Híbrido:\n${result.message}\n${result.traceback || ''}`);
                }
            } catch (error) {
                console.error('Error testing system model:', error);
                alert('Error al intentar probar el modelo híbrido.');
            }
        }

        // Override the original search functions to include translation
        const originalSearchPlayer1 = searchPlayer1;
        const originalSearchPlayer2 = searchPlayer2;
        const originalSearchPlayerFromPage = searchPlayerFromPage;

        searchPlayer1 = async function() {
            await originalSearchPlayer1();
            translateDynamicTexts();
        };

        searchPlayer2 = async function() {
            await originalSearchPlayer2();
            translateDynamicTexts();
        };

        searchPlayerFromPage = async function(pageId) {
            await originalSearchPlayerFromPage(pageId);
            translateDynamicTexts();
        };

        // ============================================================
        // SISTEMA DE TEMA CLARO/OSCURO
        // ============================================================
        
        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Mostrar mensaje
            const currentLang = localStorage.getItem('language') || 'es';
            const message = currentLang === 'es' ? 'Tema cambiado exitosamente' : 'Theme changed successfully';
            showSuccessMessage(message);
        }
        
        function applyTheme(theme) {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            const circle = document.getElementById('themeToggleCircle');
            
            if (theme === 'light') {
                // Modo Claro
                body.classList.remove('bg-gray-900');
                body.classList.add('theme-light');
                
                // Actualizar toggle
                if (toggle) {
                    toggle.classList.remove('bg-gray-600');
                    toggle.classList.add('bg-green-500');
                }
                if (circle) {
                    circle.classList.remove('translate-x-1');
                    circle.classList.add('translate-x-7');
                }
            } else {
                // Modo Oscuro
                body.classList.remove('theme-light');
                body.classList.add('bg-gray-900');
                
                // Actualizar toggle
                if (toggle) {
                    toggle.classList.remove('bg-green-500');
                    toggle.classList.add('bg-gray-600');
                }
                if (circle) {
                    circle.classList.remove('translate-x-7');
                    circle.classList.add('translate-x-1');
                }
            }
        }
        
        function showSuccessMessage(message) {
            // Crear elemento de mensaje
            const msgDiv = document.createElement('div');
            msgDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity';
            msgDiv.textContent = message;
            document.body.appendChild(msgDiv);
            
            // Remover después de 2 segundos
            setTimeout(() => {
                msgDiv.style.opacity = '0';
                setTimeout(() => msgDiv.remove(), 300);
            }, 2000);
        }
        
        // Inicializar tema al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);
        });
    </script>
    
    <!-- CSS para modo claro -->
    <style>
        /* TEMA CLARO - FONDO BLANCO */
        body.theme-light {
            background: #ffffff !important;
            color: #1f2937 !important;
        }
        
        /* Forzar fondo blanco en todos los elementos del modo claro */
        body.theme-light,
        body.theme-light *,
        body.theme-light html {
            background-color: #ffffff !important;
        }
        
        /* Fondo principal */
        body.theme-light .bg-gray-900,
        body.theme-light .main-content,
        body.theme-light .flex.h-screen,
        body.theme-light #mainApp,
        body.theme-light #landing,
        body.theme-light .bg-gradient-to-br,
        body.theme-light .from-gray-900,
        body.theme-light .via-blue-900,
        body.theme-light .to-gray-900,
        body.theme-light .min-h-screen {
            background: #ffffff !important;
        }
        
        /* Imágenes - fondo transparente */
        body.theme-light img,
        body.theme-light .player-photo,
        body.theme-light .club-logo,
        body.theme-light .w-16.h-16,
        body.theme-light .rounded-full,
        body.theme-light .fas,
        body.theme-light .fa,
        body.theme-light i {
            background-color: transparent !important;
        }
        
        /* Contenedores principales */
        body.theme-light .bg-gray-900,
        body.theme-light .main-content,
        body.theme-light .flex.h-screen,
        body.theme-light #mainApp,
        body.theme-light #landing,
        body.theme-light .bg-gradient-to-br,
        body.theme-light .from-gray-900,
        body.theme-light .via-blue-900,
        body.theme-light .to-gray-900,
        body.theme-light .min-h-screen {
            background: #f3f4f6 !important;
        }
        
        /* Sidebar en modo claro */
        body.theme-light .sidebar,
        body.theme-light #sidebar {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%) !important;
            border-right: 1px solid #e5e7eb !important;
            color: #111827 !important;
        }
        
        /* Eliminar fondos grises del sidebar */
        body.theme-light .sidebar *,
        body.theme-light #sidebar *,
        body.theme-light .nav-item,
        body.theme-light .nav-item *,
        body.theme-light li,
        body.theme-light li * {
            background-color: transparent !important;
        }
        
        body.theme-light .nav-item {
            color: #4b5563 !important;
        }
        
        body.theme-light .nav-item:hover {
            background: #f3f4f6 !important;
            color: #111827 !important;
        }
        
        body.theme-light .nav-item.active {
            background: #dcfce7 !important;
            color: #166534 !important;
        }
        
        /* Iconos del sidebar en modo claro */
        body.theme-light .nav-item i {
            color: #4b5563 !important;
        }
        
        body.theme-light .nav-item.active i {
            color: #ffffff !important;
        }
        
        /* Forzar transparencia en todos los elementos del sidebar */
        body.theme-light .sidebar span,
        body.theme-light .sidebar a,
        body.theme-light .sidebar ul,
        body.theme-light .sidebar li,
        body.theme-light .sidebar div,
        body.theme-light .sidebar p {
            background-color: transparent !important;
        }
        
        body.theme-light .nav-item:hover i {
            color: #111827 !important;
        }
        
        /* Corregir fondo del item activo del sidebar */
        body.theme-light .nav-item.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: #ffffff !important;
            border-left: 3px solid #047857 !important;
        }
        
        /* Botones y iconos en modo claro */
        body.theme-light .bg-green-500,
        body.theme-light .bg-green-600,
        body.theme-light button[class*="bg-green"] {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: #ffffff !important;
        }
        
        body.theme-light .bg-green-500 i,
        body.theme-light .bg-green-600 i,
        body.theme-light button[class*="bg-green"] i {
            color: #ffffff !important;
        }
        
        /* Cards específicas con fondo blanco y mejor contraste */
        body.theme-light .bg-gray-800:not(.sidebar):not(.nav-item),
        body.theme-light .bg-gray-700:not(.sidebar):not(.nav-item) {
            background: #ffffff !important;
            border: 2px solid #d1d5db !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Secciones específicas en modo claro */
        body.theme-light section {
            background: transparent !important;
        }
        
        /* Gradientes específicos en modo claro */
        body.theme-light .from-gray-900,
        body.theme-light .via-blue-900,
        body.theme-light .to-gray-900,
        body.theme-light .bg-gradient-to-br,
        body.theme-light .min-h-screen {
            background: #ffffff !important;
        }
        
        /* Elementos con fondos grises - hacer transparentes */
        body.theme-light .bg-gray-800,
        body.theme-light .bg-gray-700,
        body.theme-light .bg-gray-600,
        body.theme-light .bg-gray-500,
        body.theme-light .bg-gray-400,
        body.theme-light .bg-gray-300,
        body.theme-light .bg-gray-200,
        body.theme-light .bg-gray-100,
        body.theme-light .bg-blue-900,
        body.theme-light .bg-blue-800,
        body.theme-light .bg-blue-700,
        body.theme-light .bg-blue-600,
        body.theme-light .bg-blue-500,
        body.theme-light .bg-blue-400,
        body.theme-light .bg-blue-300,
        body.theme-light .bg-blue-200,
        body.theme-light .bg-blue-100 {
            background: transparent !important;
        }
        
        /* Elementos con fondo específico */
        body.theme-light .bg-opacity-50,
        body.theme-light .bg-opacity-30 {
            background: transparent !important;
        }
        
        /* Textos en modo claro - MEJOR CONTRASTE */
        body.theme-light .text-white {
            color: #000000 !important;
        }
        
        body.theme-light .text-gray-300,
        body.theme-light .text-gray-400 {
            color: #374151 !important;
        }
        
        /* Mejorar contraste de elementos */
        body.theme-light h1,
        body.theme-light h2,
        body.theme-light h3,
        body.theme-light p,
        body.theme-light span,
        body.theme-light div {
            color: #000000 !important;
        }
        
        /* Inputs en modo claro */
        body.theme-light input,
        body.theme-light select,
        body.theme-light textarea {
            background: #f9fafb !important;
            border-color: #d1d5db !important;
            color: #111827 !important;
        }
        
        body.theme-light input::placeholder {
            color: #9ca3af !important;
        }
        
        /* Bordes en modo claro */
        body.theme-light .border-gray-700,
        body.theme-light .border-gray-600 {
            border-color: #e5e7eb !important;
        }
        
        /* Gradientes en modo claro - ajustar para mejor contraste */
        body.theme-light .bg-gradient-to-r.from-blue-900 {
            background: linear-gradient(to right, #dbeafe, #e0e7ff) !important;
        }
        
        body.theme-light .bg-gradient-to-r.from-purple-900 {
            background: linear-gradient(to right, #f3e8ff, #ddd6fe) !important;
        }
        
        /* Mantener colores de acento visibles */
        body.theme-light .text-green-400 {
            color: #10b981 !important;
        }
        
        body.theme-light .text-blue-400 {
            color: #3b82f6 !important;
        }
        
        body.theme-light .text-purple-400 {
            color: #a855f7 !important;
        }
        
        body.theme-light .text-yellow-400 {
            color: #f59e0b !important;
        }
        
        body.theme-light .text-red-400 {
            color: #ef4444 !important;
        }
        
        /* Botones en modo claro - mantener visibilidad */
        body.theme-light .bg-green-600 {
            background: #16a34a !important;
        }
        
        body.theme-light .bg-blue-600 {
            background: #2563eb !important;
        }
        
        body.theme-light .bg-purple-600 {
            background: #9333ea !important;
        }
    </style>
 </body>
</html>